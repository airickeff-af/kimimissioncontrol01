<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Logs | Living Pixel Command Center</title>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=VT323&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; image-rendering: pixelated; }
        
        :root {
            --bg-primary: #f5e6c8;
            --bg-secondary: #e8d4a8;
            --bg-card: #fff8e7;
            --accent-primary: #8b7355;
            --text-primary: #3d3225;
            --text-secondary: #6b5a45;
            --text-muted: #8b7355;
            --border: #c4b090;
            --accent-cyan: #00d4ff;
            --accent-pink: #ff2a6d;
            --accent-green: #22c55e;
            --accent-yellow: #fbbf24;
            --accent-orange: #f97316;
            --accent-purple: #a855f7;
            --accent-red: #ef4444;
        }
        
        body {
            font-family: 'VT323', monospace;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        /* Animated background grid */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                linear-gradient(rgba(0, 212, 255, 0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0, 212, 255, 0.03) 1px, transparent 1px);
            background-size: 60px 60px;
            pointer-events: none;
            z-index: 0;
            animation: gridMove 20s linear infinite;
        }
        
        @keyframes gridMove {
            0% { transform: translate(0, 0); }
            100% { transform: translate(60px, 60px); }
        }
        
        /* Header - Pixel Theme */
        .header {
            background: var(--bg-secondary);
            border-bottom: 4px solid var(--accent-primary);
            box-shadow: 0 4px 0 var(--accent-primary);
            padding: 0 2rem;
            height: 70px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .brand {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .logo {
            width: 42px;
            height: 42px;
            background: var(--accent-primary);
            border: 3px solid var(--text-primary);
            box-shadow: 3px 3px 0 var(--text-primary);
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }
        
        .brand-text h1 {
            font-family: 'Press Start 2P', cursive;
            font-size: 1rem;
            font-weight: 700;
            letter-spacing: -0.02em;
            line-height: 1.5;
        }
        
        .brand-text span {
            font-size: 0.875rem;
            color: var(--text-secondary);
            font-family: 'VT323', monospace;
        }
        
        /* Navigation - Standardized Pixel Theme */
        .nav-tabs {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }
        
        .nav-tab {
            font-family: 'Press Start 2P', cursive;
            font-size: 12px;
            padding: 8px 16px;
            background: #f5e6c8;
            border: 4px solid #8b7355;
            border-radius: 0;
            cursor: pointer;
            box-shadow: 4px 4px 0 #8b7355;
            transition: all 0.1s;
            color: var(--text-primary);
            line-height: 1.4;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }
        
        .nav-tab:hover {
            border-color: #00d4ff;
            transform: translateY(-2px);
            box-shadow: 4px 6px 0 #8b7355;
        }
        
        .nav-tab:active {
            transform: translateY(0);
            box-shadow: 0 0 0 #8b7355;
        }
        
        .nav-tab.active {
            background: #e8d4a8;
            border-color: #8b7355;
        }
        
        .main-content {
            padding: 2rem;
            max-width: 1400px;
            margin: 0 auto;
            position: relative;
            z-index: 1;
        }
        
        h2 {
            font-family: 'Press Start 2P', cursive;
            color: var(--accent-primary);
            margin-bottom: 1.5rem;
            font-size: 1.25rem;
        }
        
        .stats-bar {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }
        
        .stat-card {
            background: var(--bg-card);
            border: 4px solid var(--accent-primary);
            box-shadow: 4px 4px 0 var(--accent-primary);
            padding: 1.5rem;
            text-align: center;
            transition: all 0.3s;
        }
        
        .stat-card:hover {
            border-color: var(--text-primary);
            box-shadow: 6px 6px 0 var(--accent-primary);
            transform: translateY(-2px);
        }
        
        .stat-value {
            font-family: 'Press Start 2P', cursive;
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }
        
        .stat-label {
            font-size: 1rem;
            color: var(--text-secondary);
        }
        
        .log-table {
            width: 100%;
            background: var(--bg-card);
            border: 4px solid var(--accent-primary);
            box-shadow: 4px 4px 0 var(--accent-primary);
            overflow: hidden;
        }
        
        .log-table th {
            background: var(--bg-secondary);
            padding: 1rem;
            text-align: left;
            font-family: 'Press Start 2P', cursive;
            font-size: 0.75rem;
            color: var(--accent-primary);
            border-bottom: 4px solid var(--accent-primary);
        }
        
        .log-table td {
            padding: 1rem;
            border-bottom: 2px solid var(--border);
            font-size: 1rem;
        }
        
        .log-table tr:hover {
            background: rgba(0, 212, 255, 0.05);
        }
        
        .time-cell {
            font-family: 'VT323', monospace;
            color: var(--text-secondary);
            white-space: nowrap;
            font-size: 1.1rem;
        }
        
        .source-cell {
            font-weight: 600;
        }
        
        .source-nexus { color: var(--accent-cyan); }
        .source-ericf { color: var(--accent-green); }
        .source-user { color: var(--accent-green); }
        .source-audit { color: var(--accent-yellow); }
        .source-pixel { color: var(--accent-pink); }
        .source-forge { color: var(--accent-purple); }
        .source-code { color: var(--accent-orange); }
        .source-dealflow { color: var(--accent-cyan); }
        .source-scout { color: var(--accent-yellow); }
        .source-coldcall { color: var(--accent-red); }
        .source-sentry { color: var(--accent-purple); }
        .source-cipher { color: var(--accent-red); }
        .source-glasses { color: var(--accent-yellow); }
        .source-quill { color: var(--accent-pink); }
        .source-larry { color: var(--accent-purple); }
        .source-gary { color: var(--accent-orange); }
        .source-pie { color: var(--accent-cyan); }
        .source-agent { color: var(--text-secondary); }
        .source-system { color: var(--text-muted); }
        
        .type-badge {
            display: inline-block;
            padding: 0.25rem 0.5rem;
            border: 2px solid;
            font-size: 0.75rem;
            font-weight: 500;
            text-transform: uppercase;
            font-family: 'Press Start 2P', cursive;
        }
        
        .type-user_message { background: rgba(34, 197, 94, 0.1); border-color: var(--accent-green); color: var(--accent-green); }
        .type-agent_response { background: rgba(0, 212, 255, 0.1); border-color: var(--accent-cyan); color: var(--accent-cyan); }
        .type-task_complete { background: rgba(168, 85, 247, 0.1); border-color: var(--accent-purple); color: var(--accent-purple); }
        .type-deployment { background: rgba(251, 191, 36, 0.1); border-color: var(--accent-yellow); color: var(--accent-yellow); }
        .type-error { background: rgba(239, 68, 68, 0.1); border-color: var(--accent-red); color: var(--accent-red); }
        .type-tool_call { background: rgba(249, 115, 22, 0.1); border-color: var(--accent-orange); color: var(--accent-orange); }
        .type-system { background: rgba(113, 113, 122, 0.1); border-color: var(--text-muted); color: var(--text-muted); }
        
        .message-cell {
            color: var(--text-secondary);
            max-width: 600px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        
        .btn {
            font-family: 'Press Start 2P', cursive;
            font-size: 0.625rem;
            padding: 0.75rem 1rem;
            background: var(--bg-card);
            border: 4px solid var(--accent-primary);
            box-shadow: 4px 4px 0 var(--accent-primary);
            color: var(--text-primary);
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .btn:hover {
            border-color: var(--accent-cyan);
            transform: translateY(-2px);
            box-shadow: 4px 6px 0 var(--accent-primary);
        }
        
        .btn:active {
            transform: translateY(0);
            box-shadow: 0 0 0 var(--accent-primary);
        }
        
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 3rem;
            color: var(--text-secondary);
            font-size: 1.25rem;
        }
        
        .loading::after {
            content: '';
            width: 20px;
            height: 20px;
            border: 3px solid var(--border);
            border-top-color: var(--accent-cyan);
            border-radius: 50%;
            margin-left: 0.75rem;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .error-message {
            background: rgba(239, 68, 68, 0.1);
            border: 4px solid var(--accent-red);
            box-shadow: 4px 4px 0 var(--accent-red);
            color: var(--accent-red);
            padding: 1rem;
            margin-bottom: 1rem;
            font-family: 'Press Start 2P', cursive;
            font-size: 0.75rem;
        }
        
        .filter-bar {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }
        
        .filter-select {
            padding: 0.5rem 1rem;
            background: var(--bg-card);
            border: 4px solid var(--accent-primary);
            color: var(--text-primary);
            font-size: 1rem;
            font-family: 'VT323', monospace;
        }
        
        .refresh-btn {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            padding: 1rem 1.5rem;
            background: var(--bg-card);
            border: 4px solid var(--accent-primary);
            box-shadow: 4px 4px 0 var(--accent-primary);
            color: var(--text-primary);
            font-family: 'Press Start 2P', cursive;
            font-size: 0.625rem;
            cursor: pointer;
            transition: all 0.2s;
            z-index: 100;
        }
        
        .refresh-btn:hover {
            border-color: var(--accent-cyan);
            transform: translateY(-2px);
            box-shadow: 4px 6px 0 var(--accent-primary);
        }
        
        .refresh-btn:active {
            transform: translateY(0);
            box-shadow: 0 0 0 var(--accent-primary);
        }
        
        .session-id {
            font-size: 0.875rem;
            color: var(--text-muted);
            font-family: 'VT323', monospace;
        }
        
        /* Responsive */
        @media (max-width: 1024px) {
            .nav-tabs {
                flex-wrap: wrap;
                max-width: 500px;
            }
            .nav-tab {
                padding: 8px 10px;
                font-size: 0.45rem;
            }
        }

        @media (max-width: 768px) {
            .header {
                padding: 0 1rem;
                height: auto;
                min-height: 70px;
                flex-wrap: wrap;
                gap: 1rem;
                padding-bottom: 1rem;
            }
            .nav-tabs {
                order: 3;
                width: 100%;
                max-width: none;
                justify-content: center;
            }
            .stats-bar {
                grid-template-columns: 1fr;
            }
            .main-content {
                padding: 1rem;
            }
            .log-table {
                font-size: 0.75rem;
            }
            .log-table th,
            .log-table td {
                padding: 0.5rem;
            }
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="brand">
            <div class="logo">üìù</div>
            <div class="brand-text">
                <h1>AI Logs</h1>
                <span>Command Center</span>
            </div>
        </div>
        
        <nav class="nav-tabs">
            <a href="index.html" class="nav-tab">üè† HQ</a>
            <a href="office.html" class="nav-tab">üè¢ Office</a>
            <a href="agents.html" class="nav-tab">üë• Agents</a>
            <a href="dealflow-view.html" class="nav-tab">üíº Deals</a>
            <a href="token-tracker.html" class="nav-tab">ü™ô Tokens</a>
            <a href="scout.html" class="nav-tab">üî≠ Scout</a>
            <a href="task-board.html" class="nav-tab">üìã Tasks</a>
            <a href="logs-view.html" class="nav-tab active">üìù Logs</a>
        </nav>
        
        <div style="display: flex; align-items: center; gap: 1rem;">
            <span style="font-size: 0.875rem; color: var(--text-secondary);">üü¢ Live Data</span>
            <button class="btn" onclick="if(window.parent!==window){window.parent.location.reload()}else{window.location.reload()}" style="font-size: 0.5rem; padding: 0.5rem;">üîÑ</button>
        </div>
    </header>

    <div class="main-content">
        <h2>üìù Recent Activity (50)</h2>
        
        <div class="stats-bar">
            <div class="stat-card">
                <div class="stat-value" style="color: var(--accent-cyan);" id="total-entries">-</div>
                <div class="stat-label">Total Entries (All Time)</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" style="color: var(--accent-green);" id="user-messages">-</div>
                <div class="stat-label">EricF Messages</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" style="color: var(--accent-purple);" id="agent-responses">-</div>
                <div class="stat-label">Agent Responses</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" style="color: var(--accent-yellow);" id="tasks-completed">-</div>
                <div class="stat-label">Tasks Completed</div>
            </div>
        </div>

        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
            <div style="display: flex; gap: 1rem; align-items: center;">
                <span style="color: var(--text-secondary); font-size: 1rem;" id="showing-text">Loading...</span>
                <span style="color: var(--text-secondary); font-size: 1rem;">|</span>
                <span style="color: var(--accent-cyan); font-size: 1rem;">üìä Real-Time Activity</span>
            </div>
            <div style="display: flex; gap: 0.5rem;">
                <button class="btn" id="expand-btn" onclick="toggleExpand()">üìÇ Show All Logs</button>
            </div>
        </div>

        <div id="error-container"></div>
        
        <div id="loading-indicator" class="loading">Loading activity logs...</div>

        <table class="log-table" id="log-table" style="display: none;">
            <thead>
                <tr>
                    <th>Time</th>
                    <th>Source</th>
                    <th>Type</th>
                    <th>Message</th>
                    <th>Session</th>
                </tr>
            </thead>
            <tbody id="log-body">
                <!-- Logs populated by JavaScript -->
            </tbody>
        </table>
    </div>

    <button class="refresh-btn" onclick="refreshLogs()">üîÑ Refresh Data</button>

    <script>
        // Configuration
        // For local dev: API is on port 3001 (Mission Control API)
        // For production (Vercel): API is at /api/* via serverless functions
        const API_BASE_URL = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1' 
            ? 'http://localhost:3001' 
            : '';
        
        let allLogs = [];
        let showAll = false;
        const RECENT_COUNT = 50;
        
        // Format timestamp for display
        function formatTime(timestamp) {
            if (!timestamp) return 'Unknown';
            try {
                const date = new Date(timestamp);
                const now = new Date();
                const isToday = date.toDateString() === now.toDateString();
                
                if (isToday) {
                    return date.toLocaleTimeString('en-US', { 
                        hour: '2-digit', 
                        minute: '2-digit',
                        hour12: false 
                    });
                } else {
                    return date.toLocaleDateString('en-US', { 
                        month: 'short', 
                        day: 'numeric',
                        hour: '2-digit',
                        minute: '2-digit',
                        hour12: false
                    });
                }
            } catch (e) {
                return timestamp;
            }
        }
        
        // Get source class for styling
        function getSourceClass(agent) {
            const agentLower = (agent || 'agent').toLowerCase();
            const validClasses = ['nexus', 'ericf', 'user', 'audit', 'pixel', 'forge', 'code', 
                                  'dealflow', 'scout', 'coldcall', 'sentry', 'cipher', 
                                  'glasses', 'quill', 'larry', 'gary', 'pie', 'system'];
            return validClasses.includes(agentLower) ? `source-${agentLower}` : 'source-agent';
        }
        
        // Get type badge class
        function getTypeClass(type) {
            const validTypes = ['user_message', 'agent_response', 'task_complete', 
                               'deployment', 'error', 'tool_call', 'system'];
            return validTypes.includes(type) ? `type-${type}` : 'type-system';
        }
        
        // Get display name for type
        function getTypeDisplay(type) {
            const typeNames = {
                'user_message': 'User',
                'agent_response': 'Response',
                'task_complete': 'Task Done',
                'deployment': 'Deploy',
                'error': 'Error',
                'tool_call': 'Tool',
                'system': 'System'
            };
            return typeNames[type] || type;
        }
        
        // Truncate message to first N words
        function truncateMessage(message, wordCount = 20) {
            if (!message) return '';
            const words = message.split(/\s+/);
            if (words.length <= wordCount) return message;
            return words.slice(0, wordCount).join(' ') + '...';
        }
        
        // Fetch logs from API
        async function fetchLogs() {
            const loadingIndicator = document.getElementById('loading-indicator');
            const logTable = document.getElementById('log-table');
            const errorContainer = document.getElementById('error-container');
            
            loadingIndicator.style.display = 'flex';
            logTable.style.display = 'none';
            errorContainer.innerHTML = '';
            
            try {
                const limit = showAll ? 1000 : RECENT_COUNT;
                // Use /api/logs/activity endpoint (works with both local server and Vercel)
                const apiUrl = API_BASE_URL 
                    ? `${API_BASE_URL}/api/logs/activity?limit=${limit}`
                    : `/api/logs/activity?limit=${limit}`;
                const response = await fetch(apiUrl);
                
                if (!response.ok) {
                    throw new Error(`API returned ${response.status}`);
                }
                
                const data = await response.json();
                allLogs = data.logs || [];
                
                renderLogs();
                updateStats();
                
                loadingIndicator.style.display = 'none';
                logTable.style.display = 'table';
                
            } catch (error) {
                console.error('Error fetching logs:', error);
                loadingIndicator.style.display = 'none';
                errorContainer.innerHTML = `
                    <div class="error-message">
                        ‚ö†Ô∏è Failed to load logs: ${error.message}. 
                        <br>Using fallback data.
                    </div>
                `;
                // Use mock data as fallback
                allLogs = getMockLogs();
                renderLogs();
                updateStats();
                logTable.style.display = 'table';
            }
        }
        
        // Render logs to table
        function renderLogs() {
            const tbody = document.getElementById('log-body');
            const logsToShow = showAll ? allLogs : allLogs.slice(0, RECENT_COUNT);
            const totalLogs = allLogs.length;
            
            if (logsToShow.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="5" style="text-align: center; padding: 3rem; color: var(--text-secondary);">
                            No activity logs found. Start interacting with agents to see logs here.
                        </td>
                    </tr>
                `;
            } else {
                tbody.innerHTML = logsToShow.map(log => {
                    const sourceClass = getSourceClass(log.agent);
                    const typeClass = getTypeClass(log.type);
                    const typeDisplay = getTypeDisplay(log.type);
                    const timeDisplay = formatTime(log.timestamp);
                    const truncatedMessage = truncateMessage(log.message, 20);
                    
                    return `
                        <tr>
                            <td class="time-cell">${timeDisplay}</td>
                            <td class="source-cell ${sourceClass}">${log.agent || 'Unknown'}</td>
                            <td><span class="type-badge ${typeClass}">${typeDisplay}</span></td>
                            <td class="message-cell" title="${log.message || ''}">${truncatedMessage}</td>
                            <td class="session-id">${log.sessionId || '-'}</td>
                        </tr>
                    `;
                }).join('');
            }
            
            // Update showing text
            document.getElementById('showing-text').textContent = showAll 
                ? `Showing all ${totalLogs} entries` 
                : `Showing most recent ${Math.min(RECENT_COUNT, totalLogs)} of ${totalLogs} entries`;
            
            // Update button
            document.getElementById('expand-btn').textContent = showAll 
                ? 'üìÇ Show Recent Only' 
                : 'üìÇ Show All Logs';
        }
        
        // Update statistics
        function updateStats() {
            const totalEntries = allLogs.length;
            const userMessages = allLogs.filter(l => l.type === 'user_message').length;
            const agentResponses = allLogs.filter(l => l.type === 'agent_response').length;
            const tasksCompleted = allLogs.filter(l => l.type === 'task_complete').length;
            
            document.getElementById('total-entries').textContent = totalEntries;
            document.getElementById('user-messages').textContent = userMessages;
            document.getElementById('agent-responses').textContent = agentResponses;
            document.getElementById('tasks-completed').textContent = tasksCompleted;
        }
        
        // Toggle between showing all logs and recent only
        function toggleExpand() {
            showAll = !showAll;
            fetchLogs();
        }
        
        // Refresh logs manually
        function refreshLogs() {
            fetchLogs();
        }
        
        // Initial load
        document.addEventListener('DOMContentLoaded', () => {
            fetchLogs();
        });
        
        // Auto-refresh every 30 seconds
        setInterval(fetchLogs, 30000);
        
        // Mock data fallback
        function getMockLogs() {
            const agents = ['nexus', 'ericf', 'audit', 'code', 'scout', 'dealflow', 'forge'];
            const types = ['user_message', 'agent_response', 'task_complete', 'tool_call'];
            const messages = [
                'Reviewed pending tasks and prioritized queue',
                'Fixed API endpoint returning 404 errors',
                'Generated new lead list for Dubai region',
                'Updated dashboard with latest metrics',
                'Completed code review for authentication module',
                'Deployed new version to production',
                'Analyzed competitor data and generated report',
                'Created new outreach templates for Q1',
                'Optimized database queries for better performance',
                'Fixed CSS styling issues on mobile view'
            ];
            
            const logs = [];
            const now = new Date();
            
            for (let i = 0; i < 50; i++) {
                const time = new Date(now.getTime() - i * 5 * 60 * 1000);
                const agent = agents[Math.floor(Math.random() * agents.length)];
                const type = agent === 'ericf' ? 'user_message' : types[Math.floor(Math.random() * types.length)];
                
                logs.push({
                    timestamp: time.toISOString(),
                    agent: agent,
                    type: type,
                    message: messages[Math.floor(Math.random() * messages.length)],
                    sessionId: `mock-${i.toString().padStart(4, '0')}`
                });
            }
            
            return logs;
        }
    </script>
</body>
</html>
