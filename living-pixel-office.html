<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Living Pixel Office | Mission Control</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;500;600&display=swap');
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        :root {
            --bg-primary: #0a0a0f;
            --bg-secondary: #111118;
            --bg-tertiary: #1a1a24;
            --bg-card: #15151d;
            --bg-elevated: #1e1e2a;
            --accent-cyan: #00d4ff;
            --accent-pink: #ff2a6d;
            --accent-purple: #a855f7;
            --accent-green: #22c55e;
            --accent-yellow: #fbbf24;
            --accent-orange: #f97316;
            --text-primary: #fafafa;
            --text-secondary: #a1a1aa;
            --text-muted: #71717a;
            --border: #27272a;
            --border-hover: #3f3f46;
        }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            overflow: hidden;
        }
        
        /* Animated grid background */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                linear-gradient(rgba(0, 212, 255, 0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0, 212, 255, 0.03) 1px, transparent 1px);
            background-size: 60px 60px;
            pointer-events: none;
            z-index: 0;
            animation: gridMove 20s linear infinite;
        }
        
        @keyframes gridMove {
            0% { transform: translate(0, 0); }
            100% { transform: translate(60px, 60px); }
        }
        
        /* Header */
        .header {
            background: rgba(17, 17, 24, 0.95);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--border);
            padding: 0 2rem;
            height: 70px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .brand {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .logo {
            width: 42px;
            height: 42px;
            background: linear-gradient(135deg, var(--accent-cyan), var(--accent-purple));
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            box-shadow: 0 0 30px rgba(0, 212, 255, 0.3);
            animation: pulse 3s ease-in-out infinite;
        }
        
        @keyframes pulse {
            0%, 100% { box-shadow: 0 0 20px rgba(0, 212, 255, 0.3); }
            50% { box-shadow: 0 0 40px rgba(0, 212, 255, 0.5), 0 0 60px rgba(168, 85, 247, 0.3); }
        }
        
        .brand-text h1 {
            font-size: 1.25rem;
            font-weight: 700;
            letter-spacing: -0.02em;
        }
        
        .brand-text span {
            font-size: 0.75rem;
            color: var(--text-muted);
            font-family: 'JetBrains Mono', monospace;
        }
        
        /* Navigation */
        .nav-tabs {
            display: flex;
            gap: 0.5rem;
            background: rgba(255,255,255,0.05);
            padding: 0.5rem;
            border-radius: 12px;
        }
        
        .nav-tab {
            padding: 0.75rem 1.25rem;
            border: none;
            background: transparent;
            color: var(--text-secondary);
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            text-decoration: none;
        }
        
        .nav-tab:hover {
            color: var(--text-primary);
            background: rgba(255,255,255,0.05);
        }
        
        .nav-tab.active {
            color: var(--text-primary);
            background: linear-gradient(135deg, var(--accent-cyan), var(--accent-purple));
            box-shadow: 0 4px 15px rgba(0, 212, 255, 0.3);
        }
        
        /* Main Layout */
        .main-container {
            display: grid;
            grid-template-columns: 1fr 380px;
            height: calc(100vh - 70px);
            position: relative;
            z-index: 1;
        }
        
        /* Office Canvas Area */
        .office-area {
            position: relative;
            background: linear-gradient(180deg, var(--bg-primary) 0%, var(--bg-secondary) 100%);
            overflow: hidden;
            border-right: 1px solid var(--border);
        }
        
        #office-canvas {
            width: 100%;
            height: 100%;
            image-rendering: pixelated;
        }
        
        /* Standup Button */
        .standup-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            padding: 12px 24px;
            background: linear-gradient(135deg, var(--accent-pink), #c92a2a);
            border: none;
            border-radius: 10px;
            color: white;
            font-family: 'Inter', sans-serif;
            font-size: 0.875rem;
            font-weight: 600;
            cursor: pointer;
            z-index: 20;
            box-shadow: 0 4px 20px rgba(255, 42, 109, 0.4);
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .standup-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 25px rgba(255, 42, 109, 0.5);
        }
        
        .standup-btn:disabled {
            background: #444;
            cursor: not-allowed;
            box-shadow: none;
        }
        
        .standup-btn.pulse {
            animation: btnPulse 2s infinite;
        }
        
        @keyframes btnPulse {
            0%, 100% { box-shadow: 0 4px 20px rgba(255, 42, 109, 0.4); }
            50% { box-shadow: 0 4px 30px rgba(255, 42, 109, 0.7); }
        }
        
        /* Meeting Status */
        .meeting-status {
            position: absolute;
            top: 70px;
            right: 20px;
            padding: 8px 16px;
            background: rgba(0,0,0,0.9);
            border: 1px solid var(--accent-cyan);
            border-radius: 8px;
            font-size: 0.875rem;
            color: var(--accent-cyan);
            z-index: 20;
            display: none;
            font-family: 'JetBrains Mono', monospace;
        }
        
        .meeting-status.active {
            display: block;
            animation: blink 1s infinite;
        }
        
        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        /* Speech Bubbles */
        .speech-bubble {
            position: absolute;
            background: var(--bg-elevated);
            border: 1px solid var(--accent-cyan);
            color: var(--text-primary);
            padding: 10px 14px;
            border-radius: 12px;
            font-size: 0.8rem;
            max-width: 200px;
            z-index: 100;
            font-family: 'Inter', sans-serif;
            box-shadow: 0 4px 20px rgba(0,0,0,0.5);
            pointer-events: none;
            animation: bubblePop 0.3s ease;
        }
        
        @keyframes bubblePop {
            from { opacity: 0; transform: scale(0.8) translateY(10px); }
            to { opacity: 1; transform: scale(1) translateY(0); }
        }
        
        .speech-bubble::after {
            content: '';
            position: absolute;
            bottom: -8px;
            left: 20px;
            border-left: 8px solid transparent;
            border-right: 8px solid transparent;
            border-top: 8px solid var(--accent-cyan);
        }
        
        .speech-bubble.peer-review {
            border-color: var(--accent-green);
            background: linear-gradient(135deg, var(--bg-elevated), rgba(34, 197, 94, 0.1));
        }
        
        .speech-bubble.peer-review::after {
            border-top-color: var(--accent-green);
        }
        
        .speech-bubble.pingpong {
            border-color: var(--accent-yellow);
            background: linear-gradient(135deg, var(--bg-elevated), rgba(251, 191, 36, 0.1));
        }
        
        .speech-bubble.pingpong::after {
            border-top-color: var(--accent-yellow);
        }
        
        /* Sidebar */
        .sidebar {
            background: var(--bg-secondary);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        .sidebar-header {
            padding: 1.25rem;
            background: linear-gradient(90deg, rgba(0,212,255,0.1), transparent);
            border-bottom: 1px solid var(--border);
        }
        
        .sidebar-header h2 {
            font-size: 1rem;
            font-weight: 600;
            color: var(--accent-cyan);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        /* Tabs */
        .tabs {
            display: flex;
            border-bottom: 1px solid var(--border);
            background: var(--bg-tertiary);
        }
        
        .tab {
            flex: 1;
            padding: 1rem;
            border: none;
            background: transparent;
            color: var(--text-secondary);
            font-family: 'Inter', sans-serif;
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            border-bottom: 2px solid transparent;
        }
        
        .tab:hover {
            color: var(--text-primary);
            background: rgba(255,255,255,0.03);
        }
        
        .tab.active {
            color: var(--accent-cyan);
            border-bottom-color: var(--accent-cyan);
            background: rgba(0,212,255,0.05);
        }
        
        .tab-content {
            flex: 1;
            overflow-y: auto;
            padding: 1rem;
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* Activity Feed */
        .activity-item {
            padding: 12px;
            margin-bottom: 8px;
            background: var(--bg-card);
            border-radius: 8px;
            border-left: 3px solid var(--accent-cyan);
            font-size: 0.875rem;
            animation: slideIn 0.3s ease;
        }
        
        .activity-item.chat {
            border-left-color: var(--accent-green);
            background: linear-gradient(90deg, rgba(34, 197, 94, 0.05), transparent);
        }
        
        .activity-item.pingpong {
            border-left-color: var(--accent-yellow);
            background: linear-gradient(90deg, rgba(251, 191, 36, 0.05), transparent);
        }
        
        @keyframes slideIn {
            from { opacity: 0; transform: translateX(-10px); }
            to { opacity: 1; transform: translateX(0); }
        }
        
        .activity-time {
            font-size: 0.75rem;
            color: var(--text-muted);
            font-family: 'JetBrains Mono', monospace;
            display: block;
            margin-bottom: 4px;
        }
        
        .activity-text {
            color: var(--text-primary);
        }
        
        .activity-agents {
            color: var(--accent-cyan);
            font-weight: 600;
        }
        
        /* Agent List */
        .agent-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            margin-bottom: 8px;
            background: var(--bg-card);
            border-radius: 10px;
            border: 1px solid var(--border);
            transition: all 0.2s;
        }
        
        .agent-item:hover {
            border-color: var(--border-hover);
            background: var(--bg-elevated);
        }
        
        .agent-avatar {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
            background: var(--bg-tertiary);
        }
        
        .agent-info {
            flex: 1;
        }
        
        .agent-name {
            font-weight: 600;
            font-size: 0.9rem;
        }
        
        .agent-desk {
            font-size: 0.75rem;
            color: var(--text-muted);
            font-family: 'JetBrains Mono', monospace;
        }
        
        .status-badge {
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.7rem;
            font-weight: 600;
            text-transform: uppercase;
        }
        
        .status-badge.working {
            background: rgba(34, 197, 94, 0.15);
            color: var(--accent-green);
        }
        
        .status-badge.busy {
            background: rgba(251, 191, 36, 0.15);
            color: var(--accent-yellow);
        }
        
        .status-badge.meeting {
            background: rgba(255, 42, 109, 0.15);
            color: var(--accent-pink);
        }
        
        .status-badge.resting {
            background: rgba(113, 113, 122, 0.15);
            color: var(--text-muted);
        }
        
        .status-badge.playing {
            background: rgba(251, 191, 36, 0.15);
            color: var(--accent-yellow);
        }
        
        /* Meeting Log */
        .meeting-info {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 1rem;
            margin-top: 1rem;
        }
        
        .meeting-info h4 {
            color: var(--accent-pink);
            margin-bottom: 12px;
            font-size: 0.9rem;
        }
        
        .topic-item {
            padding: 8px 0;
            border-bottom: 1px solid var(--border);
            font-size: 0.875rem;
            color: var(--text-secondary);
        }
        
        .topic-item:last-child {
            border-bottom: none;
        }
        
        /* Stats Bar */
        .stats-bar {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 12px;
            padding: 1rem;
            background: var(--bg-tertiary);
            border-bottom: 1px solid var(--border);
        }
        
        .stat-item {
            text-align: center;
            padding: 8px;
            background: var(--bg-card);
            border-radius: 8px;
        }
        
        .stat-value {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--accent-cyan);
            font-family: 'JetBrains Mono', monospace;
        }
        
        .stat-label {
            font-size: 0.7rem;
            color: var(--text-muted);
            margin-top: 4px;
        }
        
        /* Historical Minutes */
        .minutes-history {
            max-height: 400px;
            overflow-y: auto;
        }
        
        .minutes-entry {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
        }
        
        .minutes-entry h5 {
            color: var(--accent-cyan);
            font-size: 0.85rem;
            margin-bottom: 0.5rem;
            display: flex;
            justify-content: space-between;
        }
        
        .minutes-entry .minutes-date {
            color: var(--text-muted);
            font-size: 0.75rem;
        }
        
        /* Clear data button */
        .clear-data-btn {
            padding: 8px 16px;
            background: rgba(255, 42, 109, 0.2);
            border: 1px solid var(--accent-pink);
            border-radius: 6px;
            color: var(--accent-pink);
            font-size: 0.75rem;
            cursor: pointer;
            margin-top: 1rem;
            transition: all 0.2s;
        }
        
        .clear-data-btn:hover {
            background: rgba(255, 42, 109, 0.3);
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="brand">
            <div class="logo">üéØ</div>
            <div class="brand-text">
                <h1>Mission Control</h1>
                <span>EricF's AI Team Dashboard v2.0</span>
            </div>
        </div>
        
        <nav class="nav-tabs">
            <a href="index.html" class="nav-tab">
                <span>üìä</span> Overview
            </a>
            <a href="living-pixel-office.html" class="nav-tab active">
                <span>üè¢</span> Office
            </a>
            <a href="data-viewer.html" class="nav-tab">
                <span>üìÅ</span> Data
            </a>
            <a href="token-tracker.html" class="nav-tab">
                <span>üí∞</span> Tokens
            </a>
            <a href="task-board.html" class="nav-tab">
                <span>üìã</span> Tasks
            </a>
            <a href="logs-view.html" class="nav-tab">
                <span>üìù</span> Logs
            </a>
        </nav>
        
        <div style="display: flex; align-items: center; gap: 1rem;">
            <span style="font-size: 0.875rem; color: var(--text-muted);">üü¢ 20 Agents Active</span>
            <button class="btn" onclick="if(window.parent!==window){window.parent.location.reload()}else{window.location.reload()}" style="font-size: 0.75rem; padding: 0.25rem 0.75rem;">üîÑ Refresh</button>
        </div>
    </header>
    
    <div class="main-container">
        <!-- Office Canvas -->
        <div class="office-area">
            <canvas id="office-canvas"></canvas>
            
            <button class="standup-btn pulse" id="standup-btn" onclick="startStandup()">
                üé§ Call Standup
            </button>
            
            <div class="meeting-status" id="meeting-status">
                üé§ STANDUP IN PROGRESS
            </div>
        </div>
        
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="sidebar-header">
                <h2>üìä Command Center</h2>
            </div>
            
            <div class="stats-bar">
                <div class="stat-item">
                    <div class="stat-value">20</div>
                    <div class="stat-label">Agents</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="active-count">14</div>
                    <div class="stat-label">Active</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="meeting-count">0</div>
                    <div class="stat-label">In Meeting</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="playing-count">0</div>
                    <div class="stat-label">Playing</div>
                </div>
            </div>
            
            <div class="tabs">
                <button class="tab active" onclick="switchTab('activity', this)">üì° Activity</button>
                <button class="tab" onclick="switchTab('agents', this)">üî≠ Scout</button>
                <button class="tab" onclick="switchTab('meeting', this)">üé§ Meeting</button>
                <button class="tab" onclick="switchTab('minutes', this)">üìù Minutes</button>
            </div>
            
            <div id="activity-tab" class="tab-content active">
                <div id="activity-feed"></div>
            </div>
            
            <div id="agents-tab" class="tab-content">
                <div id="agent-list"></div>
            </div>
            
            <div id="meeting-tab" class="tab-content">
                <p style="color: var(--text-muted); font-size: 0.875rem; margin-bottom: 1rem;">
                    Click "Call Standup" to gather all 20 agents for a team meeting.
                </p>
                <div class="meeting-info" id="meeting-info" style="display: none;">
                    <h4>üìã Discussion Topics</h4>
                    <div id="meeting-topics"></div>
                </div>
                <!-- Conclusions Section -->
                <div id="meeting-conclusions" style="background: rgba(0, 212, 255, 0.05); border: 1px solid var(--accent-cyan); border-radius: 8px; padding: 1rem; margin-top: 1rem; display: none;">
                    <h4 style="color: var(--accent-cyan); margin-bottom: 0.5rem;">üéØ Meeting Conclusions</h4>
                    <div id="conclusions-content" style="font-size: 0.8rem; line-height: 1.5; color: var(--text-secondary);">
                        <p>Complete a standup to see conclusions...</p>
                    </div>
                </div>
                
                <!-- Next Standup Topics Section -->
                <div id="next-standup-topics" style="background: rgba(251, 191, 36, 0.05); border: 1px solid var(--accent-yellow); border-radius: 8px; padding: 1rem; margin-top: 1rem; display: none;">
                    <h4 style="color: var(--accent-yellow); margin-bottom: 0.5rem;">üìÖ Topics for Next Standup</h4>
                    <div id="next-topics-content" style="font-size: 0.8rem; line-height: 1.5; color: var(--text-secondary);">
                        <p>Complete a standup to generate next topics...</p>
                    </div>
                </div>
            </div>
            
            <div id="minutes-tab" class="tab-content">
                <div style="background: rgba(0,0,0,0.3); padding: 1rem; border-radius: 8px; margin-bottom: 1rem;">
                    <h4 style="color: var(--accent-cyan); margin-bottom: 0.5rem;">üìù Latest Meeting Minutes</h4>
                    <div id="meeting-minutes-display" style="font-size: 0.8rem; line-height: 1.5;">
                        <p style="color: var(--text-muted);">No standup completed yet. Start a meeting to generate minutes.</p>
                    </div>
                </div>
                
                <div style="background: rgba(168, 85, 247, 0.1); border: 1px solid var(--accent-purple); border-radius: 8px; padding: 1rem; margin-bottom: 1rem;">
                    <h4 style="color: var(--accent-purple); margin-bottom: 0.5rem;">üìö Historical Minutes</h4>
                    <div id="historical-minutes" class="minutes-history">
                        <p style="color: var(--text-muted); font-size: 0.8rem;">Past meeting minutes will appear here...</p>
                    </div>
                </div>
                
                <div style="background: rgba(0, 212, 255, 0.05); border: 1px solid var(--accent-cyan); border-radius: 8px; padding: 1rem;">
                    <h4 style="color: var(--accent-cyan); margin-bottom: 0.5rem;">üí° Nexus Peer Review</h4>
                    <div id="nexus-peer-review" style="font-size: 0.8rem; line-height: 1.5;">
                        <p style="color: var(--text-muted); margin-bottom: 0.5rem;">After each standup, Nexus analyzes the meeting and suggests improvements:</p>
                        <ul id="improvement-suggestions" style="color: var(--text-secondary); padding-left: 1.2rem;">
                            <li>Complete standup to see Nexus analysis</li>
                        </ul>
                    </div>
                    <div style="margin-top: 1rem; padding-top: 1rem; border-top: 1px solid var(--border);">
                        <button class="btn" id="add-tasks-btn" onclick="addImprovementTasks()" style="font-size: 0.75rem; padding: 0.5rem 1rem; background: var(--accent-cyan); color: #000; border: none; border-radius: 6px; cursor: pointer;">
                            ‚ûï Add Tasks to Pending
                        </button>
                        <span id="add-tasks-status" style="margin-left: 1rem; font-size: 0.75rem; color: var(--accent-green); display: none;">‚úÖ Tasks added!</span>
                    </div>
                </div>
                
                <div style="margin-top: 1rem; background: rgba(255, 42, 109, 0.05); border: 1px solid var(--accent-pink); border-radius: 8px; padding: 1rem;">
                    <h4 style="color: var(--accent-pink); margin-bottom: 0.5rem;">üìã Auto-Generated Tasks</h4>
                    <div id="auto-generated-tasks" style="font-size: 0.8rem;">
                        <p style="color: var(--text-muted);">Tasks will appear here after Nexus peer review...</p>
                    </div>
                </div>
                
                <button class="clear-data-btn" onclick="clearAllData()">üóëÔ∏è Clear All Saved Data</button>
            </div>
        </div>
    </div>

    <script>
        // ============================================
        // LOCALSTORAGE PERSISTENCE
        // ============================================
        
        const STORAGE_KEYS = {
            ACTIVITIES: 'pixelOffice_activities',
            MEETING_MINUTES: 'pixelOffice_meetingMinutes',
            AGENT_STATES: 'pixelOffice_agentStates',
            LAST_VISIT: 'pixelOffice_lastVisit'
        };
        
        // Load saved activities from localStorage
        function loadSavedActivities() {
            try {
                const saved = localStorage.getItem(STORAGE_KEYS.ACTIVITIES);
                if (saved) {
                    const activities = JSON.parse(saved);
                    const feed = document.getElementById('activity-feed');
                    feed.innerHTML = '';
                    activities.forEach(activity => {
                        const item = document.createElement('div');
                        item.className = activity.className || 'activity-item';
                        item.innerHTML = `
                            <span class="activity-time">${activity.time}</span>
                            <span class="activity-text">${activity.text}</span>
                        `;
                        feed.appendChild(item);
                    });
                    return activities.length;
                }
            } catch (e) {
                console.log('No saved activities found');
            }
            return 0;
        }
        
        // Save activities to localStorage
        function saveActivities() {
            try {
                const feed = document.getElementById('activity-feed');
                const items = Array.from(feed.children).slice(0, 50); // Keep last 50
                const activities = items.map(item => ({
                    time: item.querySelector('.activity-time')?.textContent || '',
                    text: item.querySelector('.activity-text')?.textContent || '',
                    className: item.className
                }));
                localStorage.setItem(STORAGE_KEYS.ACTIVITIES, JSON.stringify(activities));
            } catch (e) {
                console.error('Failed to save activities:', e);
            }
        }
        
        // Load meeting minutes history
        function loadMeetingMinutes() {
            try {
                const saved = localStorage.getItem(STORAGE_KEYS.MEETING_MINUTES);
                if (saved) {
                    return JSON.parse(saved);
                }
            } catch (e) {
                console.log('No saved meeting minutes found');
            }
            return [];
        }
        
        // Save meeting minutes
        function saveMeetingMinutes(minutes) {
            try {
                localStorage.setItem(STORAGE_KEYS.MEETING_MINUTES, JSON.stringify(minutes));
            } catch (e) {
                console.error('Failed to save meeting minutes:', e);
            }
        }
        
        // Add meeting minute to history
        function addMeetingMinute(minuteData) {
            const minutes = loadMeetingMinutes();
            minutes.unshift({
                ...minuteData,
                id: Date.now()
            });
            // Keep only last 20 meetings
            if (minutes.length > 20) minutes.pop();
            saveMeetingMinutes(minutes);
            renderHistoricalMinutes();
        }
        
        // Render historical minutes
        function renderHistoricalMinutes() {
            const container = document.getElementById('historical-minutes');
            const minutes = loadMeetingMinutes();
            
            if (minutes.length === 0) {
                container.innerHTML = '<p style="color: var(--text-muted); font-size: 0.8rem;">Past meeting minutes will appear here...</p>';
                return;
            }
            
            container.innerHTML = minutes.map(m => `
                <div class="minutes-entry">
                    <h5>
                        <span>üïê ${m.time}</span>
                        <span class="minutes-date">${m.date}</span>
                    </h5>
                    <div style="font-size: 0.75rem; color: var(--text-secondary);">
                        ${m.summary}
                    </div>
                </div>
            `).join('');
        }
        
        // Clear all saved data
        function clearAllData() {
            if (confirm('Are you sure you want to clear all saved activities and meeting minutes?')) {
                Object.values(STORAGE_KEYS).forEach(key => localStorage.removeItem(key));
                document.getElementById('activity-feed').innerHTML = '';
                document.getElementById('historical-minutes').innerHTML = '<p style="color: var(--text-muted); font-size: 0.8rem;">Past meeting minutes will appear here...</p>';
                document.getElementById('meeting-minutes-display').innerHTML = '<p style="color: var(--text-muted);">No standup completed yet. Start a meeting to generate minutes.</p>';
                logActivity('üóëÔ∏è All saved data cleared');
            }
        }
        
        // ============================================
        // AGENT-TO-AGENT CONVERSATIONS
        // ============================================
        
        const conversationTopics = {
            work: [
                "Hey, can you review my PR?",
                "The API is looking solid!",
                "Did you see the new design?",
                "Need help with this bug?",
                "Great job on the dashboard!",
                "Your code is so clean ‚ú®",
                "Thanks for the feedback!",
                "Let's pair on this feature",
                "The tests are passing! üéâ",
                "Refactoring complete!",
                "Love the new component!",
                "Deploy went smoothly"
            ],
            peerReview: [
                "Great job on the dashboard!",
                "Your UI work is impressive!",
                "Clean code as always! üëè",
                "Love the animation you added",
                "Solid architecture choice",
                "Thanks for documenting that!",
                "Your attention to detail üëå",
                "Excellent error handling!",
                "This solution is elegant",
                "You've leveled up! üöÄ"
            ],
            casual: [
                "Coffee break soon? ‚òï",
                "Did you see that game?",
                "Weekend plans?",
                "This weather is crazy!",
                "New restaurant nearby üçú",
                "Check out this meme üòÇ",
                "How's your project going?",
                "Lunch together today?",
                "Did you hear the news?",
                "TGIF! üéâ"
            ],
            pingpong: [
                "Ready to lose? üèì",
                "My serve!",
                "Nice shot!",
                "That was close!",
                "Rematch!",
                "I'm on fire! üî•",
                "Beginner's luck!",
                "Game on!",
                "Point to me!",
                "What a rally!"
            ]
        };
        
        // Random agent conversations
        function triggerRandomConversation() {
            if (isStandupActive || isPingPongActive) return; // Don't interrupt meetings or games
            
            // Pick two random agents who are not in a meeting
            const availableAgents = agents.filter(a => a.status !== 'meeting' && a.status !== 'playing');
            if (availableAgents.length < 2) return;
            
            const agent1 = availableAgents[Math.floor(Math.random() * availableAgents.length)];
            let agent2 = availableAgents[Math.floor(Math.random() * availableAgents.length)];
            while (agent2.id === agent1.id) {
                agent2 = availableAgents[Math.floor(Math.random() * availableAgents.length)];
            }
            
            // Pick conversation type
            const types = ['work', 'work', 'peerReview', 'casual']; // Weighted toward work
            const type = types[Math.floor(Math.random() * types.length)];
            const topics = conversationTopics[type];
            const message = topics[Math.floor(Math.random() * topics.length)];
            
            // Show conversation
            showAgentConversation(agent1, agent2, message, type);
        }
        
        function showAgentConversation(agent1, agent2, message, type) {
            // Position between the two agents
            const midX = (agent1.x + agent2.x) / 2;
            const midY = (agent1.y + agent2.y) / 2;
            const pos = toIso(midX, midY);
            
            const bubble = document.createElement('div');
            bubble.className = `speech-bubble ${type === 'peerReview' ? 'peer-review' : ''}`;
            bubble.style.left = (pos.x + canvas.parentElement.offsetLeft) + 'px';
            bubble.style.top = (pos.y + canvas.parentElement.offsetTop - 60) + 'px';
            bubble.innerHTML = `
                <strong style="color: ${agent1.color}">${agent1.name}</strong> ‚Üí 
                <strong style="color: ${agent2.color}">${agent2.name}</strong><br>
                "${message}"
            `;
            
            document.body.appendChild(bubble);
            
            // Log to activity feed
            const activityClass = type === 'peerReview' ? 'chat' : '';
            logActivity(`üí¨ ${agent1.name} ‚Üí ${agent2.name}: "${message}"`, activityClass);
            
            // Agent2 responds after a delay
            setTimeout(() => {
                const responses = type === 'peerReview' 
                    ? ["Thanks! Appreciate it! üôè", "You're too kind!", "Team effort! üí™", "Glad you like it!"]
                    : ["Haha totally! üòÑ", "I know right!", "Absolutely!", "Couldn't agree more!"];
                const response = responses[Math.floor(Math.random() * responses.length)];
                
                bubble.innerHTML += `<br><br><strong style="color: ${agent2.color}">${agent2.name}</strong>: "${response}"`;
                
                setTimeout(() => bubble.remove(), 4000);
            }, 2000);
            
            setTimeout(() => {
                if (bubble.parentNode) bubble.remove();
            }, 6000);
        }
        
        // ============================================
        // PING PONG TABLE & INTERACTIONS
        // ============================================
        
        const pingPongTable = { x: 600, y: 150, width: 80, height: 50 };
        let isPingPongActive = false;
        let pingPongPlayers = [];
        let pingPongBall = { x: 0, y: 0, vx: 0, vy: 0 };
        let pingPongScore = [0, 0];
        
        // Draw ping pong table
        function drawPingPongTable() {
            const pos = toIso(pingPongTable.x, pingPongTable.y);
            const w = pingPongTable.width * 0.7;
            const h = pingPongTable.height * 0.5;
            
            // Table shadow
            drawShadow(pos.x, pos.y + 15, w/2, h/3, 0.4);
            
            // Table top (green)
            ctx.fillStyle = '#1B5E20';
            ctx.beginPath();
            ctx.moveTo(pos.x, pos.y - h/2);
            ctx.lineTo(pos.x + w/2, pos.y - h/4);
            ctx.lineTo(pos.x, pos.y);
            ctx.lineTo(pos.x - w/2, pos.y - h/4);
            ctx.closePath();
            ctx.fill();
            
            // Table border
            ctx.strokeStyle = '#4CAF50';
            ctx.lineWidth = 2;
            ctx.stroke();
            
            // Center line
            ctx.strokeStyle = 'rgba(255,255,255,0.5)';
            ctx.lineWidth = 1;
            ctx.beginPath();
            ctx.moveTo(pos.x, pos.y - h/4);
            ctx.lineTo(pos.x, pos.y);
            ctx.stroke();
            
            // Net
            ctx.strokeStyle = '#fff';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(pos.x - 5, pos.y - h/3);
            ctx.lineTo(pos.x + 5, pos.y - h/6);
            ctx.stroke();
            
            // Net posts
            drawPixelRect(pos.x - 7, pos.y - h/3 - 5, 4, 8, '#666');
            drawPixelRect(pos.x + 3, pos.y - h/6 - 5, 4, 8, '#666');
            
            // Label
            ctx.fillStyle = '#fff';
            ctx.font = 'bold 9px Inter';
            ctx.textAlign = 'center';
            ctx.fillText('üèì PING PONG', pos.x, pos.y - h/4 + 5);
            
            // Draw ball if game is active
            if (isPingPongActive) {
                drawPingPongBall();
            }
        }
        
        function drawPingPongBall() {
            const pos = toIso(pingPongBall.x, pingPongBall.y);
            
            // Ball shadow
            drawShadow(pos.x, pos.y + 5, 4, 2, 0.3);
            
            // Ball
            ctx.fillStyle = '#FFEB3B';
            ctx.beginPath();
            ctx.arc(pos.x, pos.y, 4, 0, Math.PI * 2);
            ctx.fill();
            
            // Ball highlight
            ctx.fillStyle = '#FFF';
            ctx.beginPath();
            ctx.arc(pos.x - 1, pos.y - 1, 1.5, 0, Math.PI * 2);
            ctx.fill();
        }
        
        // Trigger random ping pong game
        function triggerPingPongGame() {
            if (isStandupActive || isPingPongActive) return;
            
            // Pick two random agents
            const availableAgents = agents.filter(a => a.status !== 'meeting' && a.status !== 'playing');
            if (availableAgents.length < 2) return;
            
            const player1 = availableAgents[Math.floor(Math.random() * availableAgents.length)];
            let player2 = availableAgents[Math.floor(Math.random() * availableAgents.length)];
            while (player2.id === player1.id) {
                player2 = availableAgents[Math.floor(Math.random() * availableAgents.length)];
            }
            
            startPingPongGame(player1, player2);
        }
        
        function startPingPongGame(player1, player2) {
            isPingPongActive = true;
            pingPongPlayers = [player1, player2];
            pingPongScore = [0, 0];
            
            // Set players to playing status
            player1.status = 'playing';
            player2.status = 'playing';
            player1.activity = 'Playing ping pong';
            player2.activity = 'Playing ping pong';
            
            // Move players to table
            player1.targetX = pingPongTable.x - 60;
            player1.targetY = pingPongTable.y;
            player2.targetX = pingPongTable.x + 60;
            player2.targetY = pingPongTable.y;
            
            player1.facing = 1;
            player2.facing = -1;
            
            isWalking[player1.id] = true;
            isWalking[player2.id] = true;
            
            logActivity(`üèì ${player1.name} and ${player2.name} started a ping pong game!`, 'pingpong');
            
            // Animate to table
            animateAgentToPingPong(player1, 0);
            animateAgentToPingPong(player2, 100);
            
            // Start game after arrival
            setTimeout(() => {
                isWalking[player1.id] = false;
                isWalking[player2.id] = false;
                startPingPongMatch();
            }, 2000);
        }
        
        function animateAgentToPingPong(agent, delay) {
            setTimeout(() => {
                const startX = agent.x, startY = agent.y;
                const endX = agent.targetX, endY = agent.targetY;
                const duration = 1500;
                const startTime = Date.now();
                
                function step() {
                    const elapsed = Date.now() - startTime;
                    const progress = Math.min(elapsed / duration, 1);
                    const ease = 1 - Math.pow(1 - progress, 3);
                    
                    agent.x = startX + (endX - startX) * ease;
                    agent.y = startY + (endY - startY) * ease;
                    
                    if (progress < 1) {
                        requestAnimationFrame(step);
                    }
                }
                step();
            }, delay);
        }
        
        function startPingPongMatch() {
            pingPongBall.x = pingPongTable.x;
            pingPongBall.y = pingPongTable.y;
            pingPongBall.vx = (Math.random() > 0.5 ? 1 : -1) * 2;
            pingPongBall.vy = (Math.random() - 0.5) * 2;
            
            let rallyCount = 0;
            const maxRallies = 5 + Math.floor(Math.random() * 10); // 5-15 rallies
            
            const gameInterval = setInterval(() => {
                if (!isPingPongActive) {
                    clearInterval(gameInterval);
                    return;
                }
                
                // Move ball
                pingPongBall.x += pingPongBall.vx;
                pingPongBall.y += pingPongBall.vy;
                
                // Bounce off table edges
                if (Math.abs(pingPongBall.x - pingPongTable.x) > 40) {
                    pingPongBall.vx *= -1;
                    rallyCount++;
                    
                    // Show occasional comments
                    if (rallyCount % 3 === 0) {
                        const speaker = rallyCount % 2 === 0 ? pingPongPlayers[0] : pingPongPlayers[1];
                        showPingPongComment(speaker);
                    }
                }
                if (Math.abs(pingPongBall.y - pingPongTable.y) > 25) {
                    pingPongBall.vy *= -1;
                }
                
                // End game after max rallies
                if (rallyCount >= maxRallies) {
                    clearInterval(gameInterval);
                    endPingPongGame();
                }
            }, 50);
        }
        
        function showPingPongComment(agent) {
            const topics = conversationTopics.pingpong;
            const message = topics[Math.floor(Math.random() * topics.length)];
            const pos = toIso(agent.x, agent.y);
            
            const bubble = document.createElement('div');
            bubble.className = 'speech-bubble pingpong';
            bubble.style.left = (pos.x + canvas.parentElement.offsetLeft) + 'px';
            bubble.style.top = (pos.y + canvas.parentElement.offsetTop - 70) + 'px';
            bubble.innerHTML = `<strong style="color: ${agent.color}">${agent.name}:</strong> "${message}"`;
            
            document.body.appendChild(bubble);
            setTimeout(() => bubble.remove(), 2000);
        }
        
        function endPingPongGame() {
            const [player1, player2] = pingPongPlayers;
            const winner = Math.random() > 0.5 ? player1 : player2;
            
            logActivity(`üèÜ ${winner.name} won the ping pong match!`, 'pingpong');
            
            // Show winner celebration
            const pos = toIso(winner.x, winner.y);
            const bubble = document.createElement('div');
            bubble.className = 'speech-bubble pingpong';
            bubble.style.left = (pos.x + canvas.parentElement.offsetLeft) + 'px';
            bubble.style.top = (pos.y + canvas.parentElement.offsetTop - 70) + 'px';
            bubble.innerHTML = `üèÜ <strong style="color: ${winner.color}">${winner.name}:</strong> "I win! Great game!"`;
            document.body.appendChild(bubble);
            setTimeout(() => bubble.remove(), 3000);
            
            // Return players to desks
            setTimeout(() => {
                returnPingPongPlayers();
            }, 1500);
        }
        
        function returnPingPongPlayers() {
            pingPongPlayers.forEach(agent => {
                const originalPos = agentPositions[agent.id];
                if (originalPos) {
                    agent.facing = originalPos.x > agent.x ? 1 : -1;
                    isWalking[agent.id] = true;
                    agent.status = 'working';
                    agent.activity = 'Back to work';
                    
                    const startX = agent.x, startY = agent.y;
                    const endX = originalPos.x, endY = originalPos.y;
                    const duration = 1500;
                    const startTime = Date.now();
                    
                    function step() {
                        const elapsed = Date.now() - startTime;
                        const progress = Math.min(elapsed / duration, 1);
                        const ease = 1 - Math.pow(1 - progress, 3);
                        
                        agent.x = startX + (endX - startX) * ease;
                        agent.y = startY + (endY - startY) * ease;
                        
                        if (progress < 1) {
                            requestAnimationFrame(step);
                        } else {
                            isWalking[agent.id] = false;
                            resetAgentActivity(agent);
                        }
                    }
                    step();
                }
            });
            
            isPingPongActive = false;
            pingPongPlayers = [];
            updateStats();
            updateAgentList();
        }
        
        // ============================================
        // WALKING COMPUTER HEAD AGENT SYSTEM
        // ============================================
        
        // Animation frame counter for global sync
        let globalFrame = 0;
        
        // 8-frame walking animation data
        // Each frame: [leftLegY, rightLegY, bodyBounce, shadowScale]
        const WALK_CYCLE = [
            [0, -4, 0, 1.0],      // Frame 0: Left down, right up
            [2, -2, -1, 0.95],    // Frame 1: Transition
            [4, 0, -2, 0.9],      // Frame 2: Left up, right down
            [2, 2, -1, 0.95],     // Frame 3: Transition
            [0, 4, 0, 1.0],       // Frame 4: Left down, right up (opposite)
            [-2, 2, -1, 0.95],    // Frame 5: Transition
            [-4, 0, -2, 0.9],     // Frame 6: Left up, right down (opposite)
            [-2, -2, -1, 0.95],   // Frame 7: Transition
        ];
        
        // Department colors for screen glow
        const DEPT_COLORS = {
            'Executive': '#ff2a6d',
            'Dev': '#22c55e',
            'Design': '#a855f7',
            'Content': '#00d4ff',
            'Growth': '#f97316',
            'Ops': '#fbbf24',
            'Business Dev': '#22c55e'
        };
        
        // All 20 agents with walking computer head design
        const agents = [
            // EXECUTIVE BALCONY (Top)
            { id: 'ericf', name: 'EricF', role: 'Commander', x: 250, y: 80, color: '#ff2a6d', status: 'working', activity: 'Strategic oversight', desk: 'Command A', dept: 'Executive', facing: 1 },
            { id: 'nexus', name: 'Nexus', role: 'Orchestrator', x: 450, y: 80, color: '#ff2a6d', status: 'working', activity: 'Monitoring systems', desk: 'Command B', dept: 'Executive', facing: 1 },
            
            // DEV TEAM - 3 Forge, 3 Code (Left)
            { id: 'forge1', name: 'Forge-1', role: 'UI Lead', x: 80, y: 200, color: '#f97316', status: 'working', activity: 'Component library', desk: 'Forge-1', dept: 'Dev', facing: 1 },
            { id: 'forge2', name: 'Forge-2', role: 'UI Dev', x: 160, y: 200, color: '#f97316', status: 'working', activity: 'Mobile responsive', desk: 'Forge-2', dept: 'Dev', facing: 1 },
            { id: 'forge3', name: 'Forge-3', role: 'UI Dev', x: 240, y: 200, color: '#f97316', status: 'working', activity: 'Animations', desk: 'Forge-3', dept: 'Dev', facing: 1 },
            { id: 'code1', name: 'Code-1', role: 'Backend Lead', x: 80, y: 280, color: '#22c55e', status: 'busy', activity: 'API endpoints', desk: 'Code-1', dept: 'Dev', facing: 1 },
            { id: 'code2', name: 'Code-2', role: 'Backend Dev', x: 160, y: 280, color: '#22c55e', status: 'working', activity: 'Database', desk: 'Code-2', dept: 'Dev', facing: 1 },
            { id: 'code3', name: 'Code-3', role: 'Backend Dev', x: 240, y: 280, color: '#22c55e', status: 'working', activity: 'Testing', desk: 'Code-3', dept: 'Dev', facing: 1 },
            
            // DESIGN TEAM (Middle)
            { id: 'pixel1', name: 'Pixel-1', role: 'Design Lead', x: 360, y: 200, color: '#a855f7', status: 'working', activity: 'Avatar design', desk: 'Pixel-1', dept: 'Design', facing: 1 },
            { id: 'pixel2', name: 'Pixel-2', role: 'Designer', x: 440, y: 200, color: '#a855f7', status: 'working', activity: 'Style guide', desk: 'Pixel-2', dept: 'Design', facing: 1 },
            { id: 'pixel3', name: 'Pixel-3', role: 'Designer', x: 520, y: 200, color: '#a855f7', status: 'working', activity: 'Assets', desk: 'Pixel-3', dept: 'Design', facing: 1 },
            
            // CONTENT TEAM (Right)
            { id: 'glasses', name: 'Glasses', role: 'Research Lead', x: 640, y: 200, color: '#00d4ff', status: 'resting', activity: 'Resting', desk: 'Research', dept: 'Content', facing: -1 },
            { id: 'quill', name: 'Quill', role: 'Content Lead', x: 720, y: 200, color: '#fbbf24', status: 'resting', activity: 'Resting', desk: 'Content', dept: 'Content', facing: -1 },
            
            // GROWTH TEAM (Right middle)
            { id: 'gary', name: 'Gary', role: 'Marketing Lead', x: 640, y: 280, color: '#f97316', status: 'resting', activity: 'Resting', desk: 'Marketing', dept: 'Growth', facing: -1 },
            { id: 'larry', name: 'Larry', role: 'Social Lead', x: 720, y: 280, color: '#22c55e', status: 'resting', activity: 'Resting', desk: 'Social', dept: 'Growth', facing: -1 },
            
            // OPS TEAM (Bottom left)
            { id: 'sentry', name: 'Sentry', role: 'DevOps Lead', x: 160, y: 380, color: '#00d4ff', status: 'working', activity: 'Monitoring', desk: 'Ops', dept: 'Ops', facing: 1 },
            { id: 'audit', name: 'Audit', role: 'QA Lead', x: 280, y: 380, color: '#fbbf24', status: 'working', activity: 'Code review', desk: 'QA', dept: 'Ops', facing: 1 },
            { id: 'cipher', name: 'Cipher', role: 'Security Lead', x: 400, y: 380, color: '#a855f7', status: 'working', activity: 'Security check', desk: 'Security', dept: 'Ops', facing: 1 },
            
            // BUSINESS DEV (Bottom right)
            { id: 'dealflow', name: 'DealFlow', role: 'BD Lead', x: 580, y: 380, color: '#f97316', status: 'busy', activity: 'Finding leads', desk: 'BD', dept: 'Business Dev', facing: -1 },
            { id: 'coldcall', name: 'ColdCall', role: 'Outreach Lead', x: 700, y: 380, color: '#22c55e', status: 'working', activity: 'Prep outreach', desk: 'Outreach', dept: 'Business Dev', facing: -1 }
        ];

        // Enhanced environment objects
        const plants = [
            { x: 30, y: 140, type: 'tree', size: 3 },
            { x: 770, y: 140, type: 'tree', size: 3 },
            { x: 30, y: 340, type: 'cactus', size: 2 },
            { x: 770, y: 340, type: 'flower', size: 1 },
            { x: 310, y: 140, type: 'bush', size: 2 },
            { x: 610, y: 140, type: 'bush', size: 2 },
            { x: 100, y: 140, type: 'fern', size: 2 },
            { x: 700, y: 340, type: 'flower2', size: 1 }
        ];
        
        // Desks for the office
        const desks = [
            // Executive desks
            { x: 250, y: 100, width: 60, height: 40, color: '#ff2a6d', label: 'CMD' },
            { x: 450, y: 100, width: 60, height: 40, color: '#ff2a6d', label: 'CMD' },
            // Dev desks - left side
            { x: 80, y: 220, width: 50, height: 35, color: '#22c55e', label: 'DEV' },
            { x: 160, y: 220, width: 50, height: 35, color: '#22c55e', label: 'DEV' },
            { x: 240, y: 220, width: 50, height: 35, color: '#22c55e', label: 'DEV' },
            { x: 80, y: 300, width: 50, height: 35, color: '#22c55e', label: 'DEV' },
            { x: 160, y: 300, width: 50, height: 35, color: '#22c55e', label: 'DEV' },
            { x: 240, y: 300, width: 50, height: 35, color: '#22c55e', label: 'DEV' },
            // Design desks - middle
            { x: 360, y: 220, width: 50, height: 35, color: '#a855f7', label: 'DSN' },
            { x: 440, y: 220, width: 50, height: 35, color: '#a855f7', label: 'DSN' },
            { x: 520, y: 220, width: 50, height: 35, color: '#a855f7', label: 'DSN' },
            // Content desks
            { x: 640, y: 220, width: 50, height: 35, color: '#00d4ff', label: 'CNT' },
            { x: 720, y: 220, width: 50, height: 35, color: '#fbbf24', label: 'CNT' },
            // Growth desks
            { x: 640, y: 300, width: 50, height: 35, color: '#f97316', label: 'GRW' },
            { x: 720, y: 300, width: 50, height: 35, color: '#22c55e', label: 'GRW' },
            // Ops desks
            { x: 160, y: 400, width: 50, height: 35, color: '#fbbf24', label: 'OPS' },
            { x: 280, y: 400, width: 50, height: 35, color: '#a855f7', label: 'OPS' },
            { x: 400, y: 400, width: 50, height: 35, color: '#00d4ff', label: 'OPS' },
            // Business dev desks
            { x: 580, y: 400, width: 50, height: 35, color: '#f97316', label: 'BD' },
            { x: 700, y: 400, width: 50, height: 35, color: '#22c55e', label: 'BD' }
        ];
        
        // Lighting effects
        const lights = [
            { x: 200, y: 50, color: '#ff2a6d', intensity: 0.3, radius: 150 },
            { x: 500, y: 50, color: '#ff2a6d', intensity: 0.3, radius: 150 },
            { x: 150, y: 180, color: '#22c55e', intensity: 0.25, radius: 120 },
            { x: 450, y: 180, color: '#a855f7', intensity: 0.25, radius: 120 },
            { x: 680, y: 180, color: '#00d4ff', intensity: 0.25, radius: 120 },
            { x: 320, y: 360, color: '#fbbf24', intensity: 0.2, radius: 100 }
        ];

        const meetingTable = { x: 400, y: 300, radius: 110 };
        let isStandupActive = false;
        let agentPositions = {};
        let isWalking = {}; // Track which agents are walking

        const canvas = document.getElementById('office-canvas');
        const ctx = canvas.getContext('2d');
        
        // Disable anti-aliasing for pixel art look
        ctx.imageSmoothingEnabled = false;
        
        function resizeCanvas() {
            canvas.width = canvas.parentElement.clientWidth;
            canvas.height = canvas.parentElement.clientHeight;
        }
        resizeCanvas();
        window.addEventListener('resize', resizeCanvas);

        // Isometric projection
        function toIso(x, y) {
            const scale = 0.7;
            const isoX = (x - y * 0.5) * scale + canvas.width / 2 - 280;
            const isoY = (y * 0.75) * scale + 80;
            return { x: isoX, y: isoY };
        }

        // Draw pixel rectangle (Minecraft style)
        function drawPixelRect(x, y, w, h, color) {
            ctx.fillStyle = color;
            ctx.fillRect(Math.floor(x), Math.floor(y), Math.floor(w), Math.floor(h));
        }
        
        // Draw pixel outline
        function drawPixelOutline(x, y, w, h, color, lineWidth = 1) {
            ctx.strokeStyle = color;
            ctx.lineWidth = lineWidth;
            ctx.strokeRect(Math.floor(x), Math.floor(y), Math.floor(w), Math.floor(h));
        }

        // Draw dynamic shadow
        function drawShadow(x, y, width, height, opacity, scale = 1) {
            ctx.save();
            ctx.globalAlpha = opacity;
            ctx.fillStyle = '#000';
            ctx.beginPath();
            ctx.ellipse(x, y, width * scale, height * scale, 0, 0, Math.PI * 2);
            ctx.fill();
            ctx.restore();
        }

        // Draw lighting effect
        function drawLighting() {
            lights.forEach(light => {
                const pos = toIso(light.x, light.y);
                const gradient = ctx.createRadialGradient(
                    pos.x, pos.y, 0,
                    pos.x, pos.y, light.radius
                );
                gradient.addColorStop(0, light.color + Math.floor(light.intensity * 255).toString(16).padStart(2, '0'));
                gradient.addColorStop(1, 'transparent');
                
                ctx.fillStyle = gradient;
                ctx.beginPath();
                ctx.arc(pos.x, pos.y, light.radius, 0, Math.PI * 2);
                ctx.fill();
            });
        }

        // Draw enhanced environment
        function drawEnvironment() {
            // Draw floor tiles
            for (let i = -5; i < 25; i++) {
                for (let j = -5; j < 20; j++) {
                    const pos = toIso(i * 50, j * 35);
                    const isEven = (i + j) % 2 === 0;
                    ctx.fillStyle = isEven ? 'rgba(0, 212, 255, 0.04)' : 'rgba(0, 212, 255, 0.02)';
                    
                    ctx.beginPath();
                    ctx.moveTo(pos.x, pos.y);
                    ctx.lineTo(pos.x + 35, pos.y + 17);
                    ctx.lineTo(pos.x, pos.y + 35);
                    ctx.lineTo(pos.x - 35, pos.y + 17);
                    ctx.closePath();
                    ctx.fill();
                    
                    ctx.strokeStyle = 'rgba(0, 212, 255, 0.06)';
                    ctx.lineWidth = 1;
                    ctx.stroke();
                }
            }
        }

        // Draw Minecraft-style plant
        function drawMinecraftPlant(plant) {
            const pos = toIso(plant.x, plant.y);
            
            if (plant.type === 'tree') {
                // Trunk - blocky
                drawPixelRect(pos.x - 5, pos.y - 25, 10, 25, '#5D4037');
                drawPixelRect(pos.x - 5, pos.y - 25, 10, 5, '#795548'); // Highlight
                // Leaves - multiple blocks
                drawPixelRect(pos.x - 18, pos.y - 55, 36, 30, '#1B5E20');
                drawPixelRect(pos.x - 14, pos.y - 65, 28, 10, '#2E7D32');
                drawPixelRect(pos.x - 10, pos.y - 72, 20, 7, '#4CAF50');
                // Leaf highlights
                drawPixelRect(pos.x - 14, pos.y - 55, 8, 8, '#2E7D32');
            } else if (plant.type === 'cactus') {
                // Main body
                drawPixelRect(pos.x - 6, pos.y - 35, 12, 35, '#2E7D32');
                drawPixelRect(pos.x - 4, pos.y - 35, 4, 35, '#4CAF50'); // Highlight
                // Left arm
                drawPixelRect(pos.x - 14, pos.y - 22, 8, 6, '#2E7D32');
                drawPixelRect(pos.x - 14, pos.y - 30, 6, 8, '#2E7D32');
                // Right arm
                drawPixelRect(pos.x + 6, pos.y - 28, 8, 6, '#2E7D32');
                drawPixelRect(pos.x + 8, pos.y - 36, 6, 8, '#2E7D32');
            } else if (plant.type === 'flower') {
                // Stem
                drawPixelRect(pos.x - 2, pos.y - 18, 4, 18, '#388E3C');
                // Leaves
                drawPixelRect(pos.x - 8, pos.y - 10, 6, 3, '#4CAF50');
                drawPixelRect(pos.x + 2, pos.y - 14, 6, 3, '#4CAF50');
                // Flower head - pixel art style
                drawPixelRect(pos.x - 10, pos.y - 28, 20, 10, '#E91E63');
                drawPixelRect(pos.x - 6, pos.y - 32, 12, 4, '#F48FB1');
                drawPixelRect(pos.x - 4, pos.y - 36, 8, 4, '#F8BBD9');
                drawPixelRect(pos.x - 3, pos.y - 26, 6, 6, '#FFEB3B'); // Center
            } else if (plant.type === 'flower2') {
                // Different flower
                drawPixelRect(pos.x - 2, pos.y - 15, 4, 15, '#388E3C');
                drawPixelRect(pos.x - 8, pos.y - 22, 16, 8, '#9C27B0');
                drawPixelRect(pos.x - 4, pos.y - 26, 8, 4, '#E1BEE7');
                drawPixelRect(pos.x - 2, pos.y - 20, 4, 4, '#FFEB3B');
            } else if (plant.type === 'bush') {
                // Bush clusters
                drawPixelRect(pos.x - 16, pos.y - 18, 32, 18, '#1B5E20');
                drawPixelRect(pos.x - 12, pos.y - 28, 24, 10, '#2E7D32');
                drawPixelRect(pos.x - 8, pos.y - 34, 16, 6, '#4CAF50');
                drawPixelRect(pos.x - 10, pos.y - 18, 6, 6, '#2E7D32');
            } else if (plant.type === 'fern') {
                // Fern fronds
                drawPixelRect(pos.x - 2, pos.y - 20, 4, 20, '#5D4037');
                drawPixelRect(pos.x - 12, pos.y - 18, 10, 4, '#2E7D32');
                drawPixelRect(pos.x - 16, pos.y - 24, 12, 4, '#388E3C');
                drawPixelRect(pos.x + 2, pos.y - 16, 10, 4, '#2E7D32');
                drawPixelRect(pos.x + 4, pos.y - 22, 12, 4, '#388E3C');
                drawPixelRect(pos.x - 10, pos.y - 28, 8, 4, '#4CAF50');
                drawPixelRect(pos.x + 2, pos.y - 26, 8, 4, '#4CAF50');
            }
        }

        // Draw enhanced desk
        function drawDesk(desk) {
            const pos = toIso(desk.x, desk.y);
            const w = desk.width * 0.6;
            const h = desk.height * 0.4;
            
            // Desk shadow
            drawShadow(pos.x, pos.y + h/2 + 5, w/2, h/4, 0.4);
            
            // Desk top (isometric block)
            ctx.fillStyle = 'rgba(30, 30, 46, 0.9)';
            ctx.beginPath();
            ctx.moveTo(pos.x, pos.y - h/2);
            ctx.lineTo(pos.x + w/2, pos.y - h/4);
            ctx.lineTo(pos.x, pos.y);
            ctx.lineTo(pos.x - w/2, pos.y - h/4);
            ctx.closePath();
            ctx.fill();
            
            // Desk edge
            ctx.fillStyle = desk.color + '40';
            ctx.beginPath();
            ctx.moveTo(pos.x - w/2, pos.y - h/4);
            ctx.lineTo(pos.x, pos.y);
            ctx.lineTo(pos.x, pos.y + h/3);
            ctx.lineTo(pos.x - w/2, pos.y + h/12);
            ctx.closePath();
            ctx.fill();
            
            ctx.fillStyle = desk.color + '60';
            ctx.beginPath();
            ctx.moveTo(pos.x, pos.y);
            ctx.lineTo(pos.x + w/2, pos.y - h/4);
            ctx.lineTo(pos.x + w/2, pos.y + h/12);
            ctx.lineTo(pos.x, pos.y + h/3);
            ctx.closePath();
            ctx.fill();
            
            // Desk outline
            ctx.strokeStyle = desk.color;
            ctx.lineWidth = 1;
            ctx.beginPath();
            ctx.moveTo(pos.x, pos.y - h/2);
            ctx.lineTo(pos.x + w/2, pos.y - h/4);
            ctx.lineTo(pos.x + w/2, pos.y + h/12);
            ctx.lineTo(pos.x, pos.y + h/3);
            ctx.lineTo(pos.x - w/2, pos.y + h/12);
            ctx.lineTo(pos.x - w/2, pos.y - h/4);
            ctx.closePath();
            ctx.stroke();
            
            // Label
            ctx.fillStyle = desk.color;
            ctx.font = 'bold 8px JetBrains Mono';
            ctx.textAlign = 'center';
            ctx.fillText(desk.label, pos.x, pos.y - h/4);
        }

        // ============================================
        // WALKING COMPUTER HEAD AGENT DRAWER
        // ============================================
        
        function drawComputerHeadAgent(agent, frameOffset = 0) {
            const pos = toIso(agent.x, agent.y);
            const isMoving = isWalking[agent.id];
            
            // Calculate animation frame
            let animFrame = 0;
            if (isMoving) {
                animFrame = Math.floor((globalFrame + frameOffset) / 4) % 8;
            }
            const cycle = WALK_CYCLE[animFrame];
            const [leftLegOffset, rightLegOffset, bodyBounce, shadowScale] = cycle;
            
            // Dynamic shadow based on position and animation
            const shadowOpacity = isMoving ? 0.3 + (shadowScale - 0.9) * 0.5 : 0.35;
            drawShadow(pos.x, pos.y + 22, 14, 6, shadowOpacity, shadowScale);
            
            // Body position with bounce
            const bodyY = pos.y + bodyBounce;
            
            // Direction multiplier (-1 for left, 1 for right)
            const dir = agent.facing || 1;
            
            // ========================================
            // LEGS (walking animation)
            // ========================================
            const legColor = '#374151'; // Dark gray
            const legHighlight = '#4B5563';
            
            if (isMoving) {
                // Left leg
                const leftLegY = bodyY + 18 + leftLegOffset;
                drawPixelRect(pos.x - 8 * dir, leftLegY, 6, 10, legColor);
                drawPixelRect(pos.x - 8 * dir, leftLegY, 2, 10, legHighlight);
                
                // Right leg
                const rightLegY = bodyY + 18 + rightLegOffset;
                drawPixelRect(pos.x + 2 * dir, rightLegY, 6, 10, legColor);
                drawPixelRect(pos.x + 2 * dir, rightLegY, 2, 10, legHighlight);
            } else {
                // Standing legs
                drawPixelRect(pos.x - 8 * dir, bodyY + 18, 6, 8, legColor);
                drawPixelRect(pos.x - 8 * dir, bodyY + 18, 2, 8, legHighlight);
                drawPixelRect(pos.x + 2 * dir, bodyY + 18, 6, 8, legColor);
                drawPixelRect(pos.x + 2 * dir, bodyY + 18, 2, 8, legHighlight);
            }
            
            // ========================================
            // BODY (small torso)
            // ========================================
            const bodyColor = '#1F2937';
            drawPixelRect(pos.x - 10 * dir, bodyY + 8, 20, 12, bodyColor);
            // Body highlight
            drawPixelRect(pos.x - 10 * dir, bodyY + 8, 20, 3, '#374151');
            // Department color accent on body
            drawPixelRect(pos.x - 6 * dir, bodyY + 12, 12, 4, agent.color + '60');
            
            // ========================================
            // COMPUTER MONITOR HEAD
            // ========================================
            const headY = bodyY - 14;
            const headW = 28;
            const headH = 22;
            const headX = pos.x - headW/2;
            
            // Monitor bezel (dark)
            drawPixelRect(headX, headY, headW, headH, '#111827');
            
            // Monitor glow effect (behind screen)
            if (!isMoving || animFrame % 2 === 0) {
                ctx.save();
                ctx.shadowColor = agent.color;
                ctx.shadowBlur = 15;
                ctx.fillStyle = agent.color + '30';
                ctx.fillRect(headX - 2, headY - 2, headW + 4, headH + 4);
                ctx.restore();
            }
            
            // Screen (glowing with department color)
            const screenPadding = 3;
            drawPixelRect(headX + screenPadding, headY + screenPadding, 
                         headW - screenPadding*2, headH - screenPadding*2, 
                         agent.color + '20');
            
            // Screen inner glow
            const screenGradient = ctx.createLinearGradient(
                headX + screenPadding, headY + screenPadding,
                headX + screenPadding, headY + headH - screenPadding
            );
            screenGradient.addColorStop(0, agent.color + '40');
            screenGradient.addColorStop(1, agent.color + '10');
            ctx.fillStyle = screenGradient;
            ctx.fillRect(headX + screenPadding, headY + screenPadding, 
                        headW - screenPadding*2, headH - screenPadding*2);
            
            // ========================================
            // PIXEL ART FACE
            // ========================================
            const faceX = headX + screenPadding + 2;
            const faceY = headY + screenPadding + 3;
            const faceColor = '#FFFFFF';
            const faceGlow = agent.color;
            
            // Eyes (2x2 pixels each)
            const eyeY = faceY + 3;
            const leftEyeX = faceX + (dir === 1 ? 3 : 12);
            const rightEyeX = faceX + (dir === 1 ? 12 : 3);
            
            // Eye glow
            ctx.fillStyle = faceGlow;
            ctx.globalAlpha = 0.6;
            drawPixelRect(leftEyeX - 1, eyeY - 1, 6, 6, faceGlow);
            drawPixelRect(rightEyeX - 1, eyeY - 1, 6, 6, faceGlow);
            ctx.globalAlpha = 1;
            
            // Eyes
            drawPixelRect(leftEyeX, eyeY, 4, 4, faceColor);
            drawPixelRect(rightEyeX, eyeY, 4, 4, faceColor);
            
            // Pupils (based on status)
            let pupilColor = '#000';
            if (agent.status === 'working') pupilColor = '#22c55e';
            else if (agent.status === 'busy') pupilColor = '#fbbf24';
            else if (agent.status === 'meeting') pupilColor = '#ff2a6d';
            else if (agent.status === 'playing') pupilColor = '#fbbf24';
            else pupilColor = '#71717a';
            
            drawPixelRect(leftEyeX + 1, eyeY + 1, 2, 2, pupilColor);
            drawPixelRect(rightEyeX + 1, eyeY + 1, 2, 2, pupilColor);
            
            // Mouth (changes based on status)
            const mouthY = faceY + 12;
            const mouthX = faceX + 6;
            
            if (agent.status === 'meeting') {
                // Open mouth (talking)
                drawPixelRect(mouthX, mouthY, 8, 4, '#000');
                drawPixelRect(mouthX + 2, mouthY + 1, 4, 2, '#ff6b6b');
            } else if (agent.status === 'playing') {
                // Big smile (having fun)
                drawPixelRect(mouthX + 1, mouthY + 1, 6, 3, '#000');
                drawPixelRect(mouthX, mouthY, 2, 2, '#000');
                drawPixelRect(mouthX + 6, mouthY, 2, 2, '#000');
                drawPixelRect(mouthX + 2, mouthY + 2, 4, 2, '#FFEB3B'); // Teeth
            } else if (agent.status === 'working') {
                // Happy smile
                drawPixelRect(mouthX + 1, mouthY + 1, 6, 2, '#000');
                drawPixelRect(mouthX, mouthY, 2, 2, '#000');
                drawPixelRect(mouthX + 6, mouthY, 2, 2, '#000');
            } else {
                // Neutral
                drawPixelRect(mouthX + 2, mouthY + 1, 4, 2, '#000');
            }
            
            // Monitor outline
            drawPixelOutline(headX, headY, headW, headH, agent.color, 2);
            
            // Monitor stand/neck
            drawPixelRect(pos.x - 3, bodyY - 2, 6, 4, '#374151');
            
            // ========================================
            // STATUS INDICATOR (floating pixel)
            // ========================================
            const statusColor = agent.status === 'working' ? '#22c55e' : 
                               agent.status === 'busy' ? '#fbbf24' : 
                               agent.status === 'meeting' ? '#ff2a6d' : 
                               agent.status === 'playing' ? '#fbbf24' : '#71717a';
            
            // Floating indicator above head
            const indicatorY = headY - 8 + Math.sin(globalFrame * 0.1) * 2;
            
            // Glow
            ctx.save();
            ctx.shadowColor = statusColor;
            ctx.shadowBlur = 8;
            drawPixelRect(pos.x - 3, indicatorY, 6, 6, statusColor);
            ctx.restore();
            
            // ========================================
            // NAME LABEL
            // ========================================
            ctx.fillStyle = '#fafafa';
            ctx.font = 'bold 10px Inter';
            ctx.textAlign = 'center';
            ctx.fillText(agent.name, pos.x, bodyY + 38);
            
            // Activity
            ctx.fillStyle = '#a1a1aa';
            ctx.font = '8px Inter';
            ctx.fillText(agent.activity.substring(0, 18), pos.x, bodyY + 48);
        }

        // Draw meeting table
        function drawMeetingTableObj() {
            const pos = toIso(meetingTable.x, meetingTable.y);
            
            // Table shadow
            drawShadow(pos.x, pos.y + 20, 70, 35, 0.5);
            
            // Table base (Minecraft block style)
            ctx.fillStyle = 'rgba(255, 42, 109, 0.15)';
            ctx.strokeStyle = '#ff2a6d';
            ctx.lineWidth = 2;
            
            // Top ellipse
            ctx.beginPath();
            ctx.ellipse(pos.x, pos.y, 70, 35, 0, 0, Math.PI * 2);
            ctx.fill();
            ctx.stroke();
            
            // Inner glow
            const tableGradient = ctx.createRadialGradient(
                pos.x, pos.y, 0,
                pos.x, pos.y, 50
            );
            tableGradient.addColorStop(0, 'rgba(255, 42, 109, 0.3)');
            tableGradient.addColorStop(1, 'transparent');
            ctx.fillStyle = tableGradient;
            ctx.beginPath();
            ctx.ellipse(pos.x, pos.y, 50, 25, 0, 0, Math.PI * 2);
            ctx.fill();
            
            // Label
            ctx.fillStyle = '#ff2a6d';
            ctx.font = 'bold 11px Inter';
            ctx.textAlign = 'center';
            ctx.fillText('MEETING TABLE', pos.x, pos.y + 4);
        }

        // Draw command balcony
        function drawCommandBalcony() {
            const pos1 = toIso(200, 60);
            const pos2 = toIso(500, 60);
            
            // Balcony floor
            ctx.fillStyle = 'rgba(255, 42, 109, 0.1)';
            ctx.strokeStyle = '#ff2a6d';
            ctx.lineWidth = 2;
            
            ctx.beginPath();
            ctx.moveTo(pos1.x - 90, pos1.y);
            ctx.lineTo(pos2.x + 90, pos2.y);
            ctx.lineTo(pos2.x + 90, pos2.y + 25);
            ctx.lineTo(pos1.x - 90, pos1.y + 25);
            ctx.closePath();
            ctx.fill();
            ctx.stroke();
            
            // Railing
            ctx.strokeStyle = '#ff2a6d';
            ctx.lineWidth = 1;
            for (let i = 0; i < 8; i++) {
                const x = pos1.x - 80 + i * 50;
                ctx.beginPath();
                ctx.moveTo(x, pos1.y);
                ctx.lineTo(x, pos1.y + 20);
                ctx.stroke();
            }
            
            // Label
            ctx.fillStyle = '#ff2a6d';
            ctx.font = 'bold 11px Inter';
            ctx.textAlign = 'center';
            const centerX = (pos1.x + pos2.x) / 2;
            ctx.fillText('COMMAND CENTER', centerX, pos1.y + 15);
        }

        // Main draw function
        function drawOffice() {
            // Clear
            ctx.fillStyle = '#0a0a0f';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Draw environment
            drawEnvironment();
            
            // Draw lighting effects (subtle)
            drawLighting();
            
            // Draw plants (behind everything)
            plants.forEach(plant => drawMinecraftPlant(plant));
            
            // Draw command balcony
            drawCommandBalcony();
            
            // Draw ping pong table
            drawPingPongTable();
            
            // Draw meeting table
            drawMeetingTableObj();
            
            // Draw desks (behind agents)
            desks.forEach(desk => drawDesk(desk));
            
            // Draw agents (walking computer heads!)
            agents.forEach((agent, index) => {
                drawComputerHeadAgent(agent, index * 2);
            });
            
            // Draw meeting connections if active
            if (isStandupActive) {
                drawMeetingConnections();
            }
            
            // Increment global frame
            globalFrame++;
        }

        // Draw meeting connections
        function drawMeetingConnections() {
            const tablePos = toIso(meetingTable.x, meetingTable.y);
            
            agents.filter(a => a.status === 'meeting').forEach(agent => {
                const agentPos = toIso(agent.x, agent.y);
                
                ctx.strokeStyle = 'rgba(255, 42, 109, 0.3)';
                ctx.lineWidth = 1;
                ctx.setLineDash([4, 4]);
                ctx.beginPath();
                ctx.moveTo(agentPos.x, agentPos.y);
                ctx.lineTo(tablePos.x, tablePos.y);
                ctx.stroke();
                ctx.setLineDash([]);
            });
        }

        // Animation loop
        function animate() {
            drawOffice();
            requestAnimationFrame(animate);
        }
        animate();

        // ============================================
        // STANDUP FUNCTIONALITY
        // ============================================
        
        const discussionTopics = [
            "Reviewing my past 24h work...",
            "I completed 3 tasks yesterday with good quality",
            "My quality score improved after the last standup",
            "I have an idea to optimize our workflow",
            "I should collaborate with Pixel on the design",
            "I learned something that could help Code team",
            "My API response times improved by 20%",
            "I found a pattern we could automate",
            "I should document this for future reference",
            "My work quality is trending upward",
            "I completed the lead research ahead of schedule",
            "I have feedback on the new dashboard UX"
        ];

        function startStandup() {
            if (isStandupActive) return;
            
            isStandupActive = true;
            document.getElementById('standup-btn').disabled = true;
            document.getElementById('standup-btn').textContent = 'üé§ Meeting in Progress...';
            document.getElementById('standup-btn').classList.remove('pulse');
            document.getElementById('meeting-status').classList.add('active');
            
            logActivity('üé§ STANDUP CALLED! All 20 agents gathering for 24h review...');
            
            // Move agents to meeting table with walking animation
            agents.forEach((agent, index) => {
                agentPositions[agent.id] = { x: agent.x, y: agent.y };
                
                const angle = (Math.PI * 2 / agents.length) * index;
                const radius = 90;
                
                agent.targetX = meetingTable.x + Math.cos(angle) * radius;
                agent.targetY = meetingTable.y + Math.sin(angle) * radius;
                
                // Determine facing direction based on target
                agent.facing = agent.targetX > agent.x ? 1 : -1;
                
                // Start walking
                isWalking[agent.id] = true;
                agent.status = 'meeting';
                agent.activity = 'Walking to meeting';
                
                animateAgentToMeeting(agent, index * 100);
            });
            
            updateStats();
            updateAgentList();
            
            // Show speech bubbles after arrival
            setTimeout(() => {
                agents.forEach((agent, index) => {
                    setTimeout(() => showSpeechBubble(agent), index * 400);
                });
            }, 2000);
            
            // End after 30 seconds (demo mode)
            setTimeout(() => endStandup(), 30000);
        }

        function animateAgentToMeeting(agent, delay) {
            setTimeout(() => {
                const startX = agent.x, startY = agent.y;
                const endX = agent.targetX, endY = agent.targetY;
                const duration = 1500;
                const startTime = Date.now();
                
                function step() {
                    const elapsed = Date.now() - startTime;
                    const progress = Math.min(elapsed / duration, 1);
                    const ease = 1 - Math.pow(1 - progress, 3);
                    
                    agent.x = startX + (endX - startX) * ease;
                    agent.y = startY + (endY - startY) * ease;
                    
                    if (progress < 1) {
                        requestAnimationFrame(step);
                    } else {
                        // Arrived - stop walking
                        isWalking[agent.id] = false;
                        agent.activity = 'Reviewing 24h work';
                    }
                }
                step();
            }, delay);
        }

        function showSpeechBubble(agent) {
            const topic = discussionTopics[Math.floor(Math.random() * discussionTopics.length)];
            const pos = toIso(agent.x, agent.y);
            
            const bubble = document.createElement('div');
            bubble.className = 'speech-bubble';
            bubble.style.left = (pos.x + canvas.parentElement.offsetLeft + 20) + 'px';
            bubble.style.top = (pos.y + canvas.parentElement.offsetTop - 70) + 'px';
            bubble.innerHTML = `<strong style="color: ${agent.color}">${agent.name}:</strong> ${topic}`;
            
            document.body.appendChild(bubble);
            logActivity(`üí¨ ${agent.name}: "${topic.substring(0, 30)}..."`);
            
            setTimeout(() => bubble.remove(), 5000);
        }

        function endStandup() {
            logActivity('‚úÖ Standup complete! Agents returning to desks...');
            
            // Generate meeting minutes
            generateMeetingMinutes();
            
            // Return agents to desks
            agents.forEach((agent, index) => {
                const originalPos = agentPositions[agent.id];
                if (originalPos) {
                    // Determine facing direction
                    agent.facing = originalPos.x > agent.x ? 1 : -1;
                    
                    // Start walking back
                    isWalking[agent.id] = true;
                    agent.status = 'working';
                    agent.activity = 'Returning to desk';
                    
                    animateAgentReturn(agent, originalPos, index * 50);
                }
            });
            
            isStandupActive = false;
            document.getElementById('standup-btn').disabled = false;
            document.getElementById('standup-btn').textContent = 'üé§ Call Standup';
            document.getElementById('standup-btn').classList.add('pulse');
            document.getElementById('meeting-status').classList.remove('active');
            
            updateStats();
            updateAgentList();
        }
        
        function generateMeetingMinutes() {
            const now = new Date();
            const timeStr = now.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' });
            const dateStr = now.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
            
            // Generate random insights based on current activities
            const insights = [
                "DealFlow reports 26 leads found, 4 more needed to reach daily quota.",
                "Pixel-2 completed walking computer head animations ahead of schedule.",
                "Code fixed API 404 errors - all endpoints now functional.",
                "Forge delivered agent performance dashboard with real-time metrics.",
                "Glasses and Scout completed new task assignments - no more resting agents.",
                "Audit verified all 4 critical tasks passed with 85-92/100 scores.",
                "Sentry installed PyTorch - Pixel can now generate AI images.",
                "Nexus standardized all dashboard headers and added Logs tab."
            ];
            
            const improvements = [
                "Continue daily 30 leads quota - focus on DeFi/RWA priority.",
                "Deploy Code API fixes to production before Feb 18 deadline.",
                "Generate agent avatars using newly installed PyTorch.",
                "Monitor competitor intelligence - Maya IPO could be opportunity.",
                "Use lead scoring algorithm to prioritize outreach.",
                "Schedule next standup for tomorrow 9 AM to track progress."
            ];
            
            // Pick 3 random insights and 2 improvements
            const selectedInsights = insights.sort(() => 0.5 - Math.random()).slice(0, 3);
            const selectedImprovements = improvements.sort(() => 0.5 - Math.random()).slice(0, 2);
            
            const minutesHTML = `
                <div style="margin-bottom: 1rem;">
                    <strong style="color: var(--accent-cyan);">üïê ${timeStr} - Standup Complete</strong>
                </div>
                
                <div style="margin-bottom: 1rem;">
                    <strong>üìä Key Updates:</strong>
                    <ul style="margin: 0.5rem 0; padding-left: 1.2rem;">
                        ${selectedInsights.map(i => `<li style="margin-bottom: 0.3rem;">${i}</li>`).join('')}
                    </ul>
                </div>
                
                <div style="margin-bottom: 1rem;">
                    <strong>üí° Improvements to Focus On:</strong>
                    <ul style="margin: 0.5rem 0; padding-left: 1.2rem;">
                        ${selectedImprovements.map(i => `<li style="margin-bottom: 0.3rem;">${i}</li>`).join('')}
                    </ul>
                </div>
                
                <div style="border-top: 1px solid var(--border); padding-top: 0.5rem; margin-top: 0.5rem; font-size: 0.75rem; color: var(--text-muted);">
                    üìù Minutes auto-generated by Nexus | Next standup: Tomorrow 9:00 AM
                </div>
            `;
            
            // Update the Minutes tab display
            document.getElementById('meeting-minutes-display').innerHTML = minutesHTML;
            
            // Add to historical minutes
            addMeetingMinute({
                time: timeStr,
                date: dateStr,
                summary: `${selectedInsights.length} updates discussed, ${selectedImprovements.length} action items identified.`
            });
            
            // Show meeting info sections
            document.getElementById('meeting-info').style.display = 'block';
            document.getElementById('meeting-conclusions').style.display = 'block';
            document.getElementById('next-standup-topics').style.display = 'block';
            
            // Generate conclusions for Meeting tab
            const conclusionsHTML = `
                <ul style="margin: 0; padding-left: 1.2rem;">
                    <li style="margin-bottom: 0.5rem;">‚úÖ <strong>Lead Generation:</strong> 26/30 leads found (87% complete) - 4 more needed</li>
                    <li style="margin-bottom: 0.5rem;">‚úÖ <strong>System Status:</strong> All 20 agents operational, 13 heartbeats active</li>
                    <li style="margin-bottom: 0.5rem;">‚úÖ <strong>Deliverables:</strong> 18 tasks completed today (100% of target)</li>
                    <li style="margin-bottom: 0.5rem;">‚ö†Ô∏è <strong>Critical:</strong> Code API 404 errors need deployment before noon deadline</li>
                    <li>üí° <strong>Opportunity:</strong> Maya IPO identified - schedule outreach call</li>
                </ul>
            `;
            document.getElementById('conclusions-content').innerHTML = conclusionsHTML;
            
            // Generate next standup topics
            const nextTopicsHTML = `
                <ul style="margin: 0; padding-left: 1.2rem;">
                    <li style="margin-bottom: 0.5rem;">üìä <strong>Lead Quota:</strong> Did we reach 30 leads/day?</li>
                    <li style="margin-bottom: 0.5rem;">üîß <strong>Code API:</strong> Are 404 errors fixed and deployed?</li>
                    <li style="margin-bottom: 0.5rem;">üé® <strong>Pixel:</strong> Agent avatar generation progress with PyTorch</li>
                    <li style="margin-bottom: 0.5rem;">üìà <strong>New Tasks:</strong> Progress on 10 improvement tasks assigned</li>
                    <li>ü§ù <strong>Maya IPO:</strong> Outreach call scheduled and executed?</li>
                </ul>
            `;
            document.getElementById('next-topics-content').innerHTML = nextTopicsHTML;
            
            // Generate Nexus peer review
            generateNexusPeerReview(selectedInsights, selectedImprovements);
            
            // Also log to activity feed
            logActivity(`üìù Meeting minutes generated for ${timeStr} standup`);
        }
        
        // Store improvement tasks for adding to pending
        let pendingImprovementTasks = [];
        
        function generateNexusPeerReview(insights, improvements) {
            // Analyze meeting for improvement opportunities
            const reviewPoints = [
                "üìà DealFlow lead generation is 87% complete - need 4 more leads to hit quota",
                "üé® Pixel team delivered visual updates ahead of schedule - consider giving more design autonomy",
                "üîß Code API issues resolved quickly - good response time on critical bugs",
                "üìä New dashboards (Performance, Logs) improving visibility - continue this trend",
                "ü§ù Scout's competitor monitoring identified Maya IPO opportunity - act fast",
                "‚ö° System running smoothly with 13 heartbeats - no major issues detected"
            ];
            
            // Generate auto-tasks based on review
            pendingImprovementTasks = [
                { id: 'AUTO-001', title: 'Follow up on 4 remaining leads for daily quota', assignee: 'DealFlow', priority: 'P0' },
                { id: 'AUTO-002', title: 'Schedule Maya IPO opportunity call', assignee: 'ColdCall', priority: 'P1' },
                { id: 'AUTO-003', title: 'Generate agent avatars with PyTorch', assignee: 'Pixel', priority: 'P2' },
                { id: 'AUTO-004', title: 'Deploy Code API fixes to production', assignee: 'Code', priority: 'P0' },
                { id: 'AUTO-005', title: 'Create weekly performance review template', assignee: 'Glasses', priority: 'P2' }
            ];
            
            const reviewHTML = `
                <p style="color: var(--text-muted); margin-bottom: 0.5rem;">
                    <strong>Nexus Analysis:</strong> Reviewed ${insights.length} updates and identified ${improvements.length} improvement areas.
                </p>
                <ul style="color: var(--text-secondary); padding-left: 1.2rem; margin-bottom: 1rem;">
                    ${reviewPoints.slice(0, 4).map(point => `<li style="margin-bottom: 0.3rem;">${point}</li>`).join('')}
                </ul>
                <p style="color: var(--accent-cyan); font-size: 0.75rem;">
                    üí° ${pendingImprovementTasks.length} auto-generated tasks ready to add to pending
                </p>
            `;
            
            document.getElementById('nexus-peer-review').innerHTML = reviewHTML;
            
            // Show auto-generated tasks
            const tasksHTML = pendingImprovementTasks.map(task => `
                <div style="background: rgba(255,255,255,0.05); padding: 0.5rem; border-radius: 4px; margin-bottom: 0.5rem; border-left: 3px solid ${task.priority === 'P0' ? 'var(--accent-pink)' : 'var(--accent-cyan)'};">
                    <div style="font-weight: 600; color: var(--text-primary);">${task.title}</div>
                    <div style="font-size: 0.75rem; color: var(--text-muted);">üë§ ${task.assignee} | ${task.priority}</div>
                </div>
            `).join('');
            
            document.getElementById('auto-generated-tasks').innerHTML = tasksHTML;
        }
        
        function addImprovementTasks() {
            if (pendingImprovementTasks.length === 0) {
                alert('No improvement tasks to add. Complete a standup first!');
                return;
            }
            
            // In a real implementation, this would add tasks to the backend
            // For now, we'll show a confirmation and log it
            const taskCount = pendingImprovementTasks.length;
            logActivity(`‚ûï Nexus added ${taskCount} improvement tasks to pending queue`);
            
            // Show success status
            const statusEl = document.getElementById('add-tasks-status');
            const btnEl = document.getElementById('add-tasks-btn');
            
            if (statusEl) {
                statusEl.style.display = 'inline';
                statusEl.textContent = `‚úÖ ${taskCount} tasks added!`;
            }
            
            if (btnEl) {
                btnEl.textContent = '‚úì Added!';
                btnEl.style.background = 'var(--accent-green)';
                btnEl.disabled = true;
            }
            
            // Show alert with details
            alert(`‚úÖ ${taskCount} improvement tasks added to pending queue!\n\nTasks:\n${pendingImprovementTasks.map(t => `- ${t.title}`).join('\n')}`);
            
            // Clear the pending tasks
            pendingImprovementTasks = [];
            document.getElementById('auto-generated-tasks').innerHTML = '<p style="color: var(--text-muted);">‚úÖ Tasks added to pending queue!</p>';
            
            // Reset button after 3 seconds
            setTimeout(() => {
                if (btnEl) {
                    btnEl.textContent = '‚ûï Add Tasks to Pending';
                    btnEl.style.background = 'var(--accent-cyan)';
                    btnEl.disabled = false;
                }
                if (statusEl) {
                    statusEl.style.display = 'none';
                }
            }, 3000);
        }

        function animateAgentReturn(agent, targetPos, delay) {
            setTimeout(() => {
                const startX = agent.x, startY = agent.y;
                const duration = 1500;
                const startTime = Date.now();
                
                function step() {
                    const elapsed = Date.now() - startTime;
                    const progress = Math.min(elapsed / duration, 1);
                    const ease = 1 - Math.pow(1 - progress, 3);
                    
                    agent.x = startX + (targetPos.x - startX) * ease;
                    agent.y = startY + (targetPos.y - startY) * ease;
                    
                    if (progress < 1) {
                        requestAnimationFrame(step);
                    } else {
                        // Arrived - stop walking
                        isWalking[agent.id] = false;
                        agent.activity = 'Back to work';
                        
                        // Reset activities after a moment
                        setTimeout(() => {
                            resetAgentActivity(agent);
                        }, 1000);
                    }
                }
                step();
            }, delay);
        }
        
        function resetAgentActivity(agent) {
            const activities = {
                'Executive': ['Strategic oversight', 'Monitoring systems'],
                'Dev': ['Component library', 'Mobile responsive', 'Animations', 'API endpoints', 'Database', 'Testing'],
                'Design': ['Avatar design', 'Style guide', 'Assets'],
                'Content': ['Researching', 'Content creation'],
                'Growth': ['Marketing strategy', 'Social media'],
                'Ops': ['Monitoring', 'Code review', 'Security check'],
                'Business Dev': ['Finding leads', 'Prep outreach']
            };
            
            const deptActivities = activities[agent.dept] || ['Working'];
            agent.activity = deptActivities[Math.floor(Math.random() * deptActivities.length)];
            updateAgentList();
        }

        // UI Functions
        function switchTab(tabName, clickedTab) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            clickedTab.classList.add('active');
            document.getElementById(tabName + '-tab').classList.add('active');
        }

        function logActivity(text, className = '') {
            const feed = document.getElementById('activity-feed');
            const time = new Date().toLocaleTimeString('en-US', { hour12: false });
            
            const item = document.createElement('div');
            item.className = 'activity-item ' + className;
            item.innerHTML = `
                <span class="activity-time">${time}</span>
                <span class="activity-text">${text}</span>
            `;
            feed.insertBefore(item, feed.firstChild);
            while (feed.children.length > 20) feed.removeChild(feed.lastChild);
            
            // Save to localStorage
            saveActivities();
        }

        function updateStats() {
            const active = agents.filter(a => a.status === 'working' || a.status === 'busy').length;
            const meeting = agents.filter(a => a.status === 'meeting').length;
            const playing = agents.filter(a => a.status === 'playing').length;
            document.getElementById('active-count').textContent = active;
            document.getElementById('meeting-count').textContent = meeting;
            document.getElementById('playing-count').textContent = playing;
        }

        function updateAgentList() {
            document.getElementById('agent-list').innerHTML = agents.map(agent => `
                <div class="agent-item">
                    <div class="agent-avatar" style="border: 2px solid ${agent.color}">${agent.name[0]}</div>
                    <div class="agent-info">
                        <div class="agent-name" style="color: ${agent.color}">${agent.name}</div>
                        <div class="agent-desk">${agent.desk} ‚Ä¢ ${agent.activity}</div>
                    </div>
                    <span class="status-badge ${agent.status}">${agent.status}</span>
                </div>
            `).join('');
        }

        // Initial setup
        const savedCount = loadSavedActivities();
        renderHistoricalMinutes();
        
        if (savedCount === 0) {
            logActivity('üè¢ Pixel Office v8 loaded with Walking Computer Head Agents!');
            logActivity('ü§ñ 20 agents with 8-frame walking animation ready');
            logActivity('üí¨ Agent-to-agent conversations enabled');
            logActivity('üèì Ping pong table added for fun meetups');
            logActivity('üíæ Activities now persist across refreshes');
        } else {
            logActivity(`üìÇ Loaded ${savedCount} saved activities from previous session`);
        }
        
        updateStats();
        updateAgentList();
        
        // Random events loop
        setInterval(() => {
            if (!isStandupActive && !isPingPongActive) {
                // 30% chance for conversation, 20% chance for ping pong
                const roll = Math.random();
                if (roll < 0.3) {
                    triggerRandomConversation();
                } else if (roll < 0.5) {
                    triggerPingPongGame();
                }
            }
        }, 15000); // Check every 15 seconds
        
        // Auto-refresh every 30 minutes for latest data
        setInterval(() => {
            console.log('Auto-refreshing office...');
            if(window.parent!==window){window.parent.location.reload()}else{window.location.reload()}
        }, 1800000);
    </script>
</body>
</html>