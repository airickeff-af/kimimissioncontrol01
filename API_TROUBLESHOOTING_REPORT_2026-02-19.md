# API Troubleshooting Report - /api/logs/activity 404 Fix

**Date:** February 19, 2026  
**Status:** Fixes prepared, awaiting deployment  
**Issue:** `/api/logs/activity` returns 404 on Vercel

---

## Root Cause Analysis

After investigating the codebase, I identified several potential issues:

1. **Vercel.json Configuration**: The rewrite rules may not be correctly routing requests to the API files
2. **Module Format Mix**: Some files use ES modules (`export default`) while others use CommonJS (`module.exports`)
3. **Nested Folder Structure**: The `/api/logs/activity.js` path might not be resolving correctly

---

## Attempted Fixes

### Fix 1: Simplified API Endpoint (APPLIED)
**File:** `/mission-control/dashboard/api/logs/activity.js`

- Removed complex validation imports that might cause issues
- Simplified to pure CommonJS format
- Added explicit Content-Type header

### Fix 2: Updated vercel.json with Explicit Routes (APPLIED)
**File:** `/mission-control/dashboard/vercel.json`

```json
{
  "version": 2,
  "name": "mission-control-dashboard",
  "headers": [...],
  "rewrites": [
    { "source": "/api/logs/activity", "destination": "/api/logs/activity.js" },
    { "source": "/api/logs/chat", "destination": "/api/logs/chat.js" },
    { "source": "/api/logs", "destination": "/api/logs/index.js" },
    { "source": "/api/(.*)", "destination": "/api/$1" },
    { "source": "/(.*)", "destination": "/$1" }
  ]
}
```

### Fix 3: Flat File Alternative (APPLIED)
**File:** `/mission-control/dashboard/api/logs-activity.js`

Created a flat file version as a fallback. This can be accessed at:
- `/api/logs-activity` (direct)
- `/api/logs/activity` (with rewrite)

---

## Alternative Approaches to Try

### Approach A: Next.js API Routes Pattern
If the current setup continues to fail, convert to Next.js structure:
```
/pages/api/logs/activity.js  (or /app/api/logs/activity/route.js for App Router)
```

### Approach B: Static JSON with Build-time Generation
Generate a static `logs.json` file at build time:
```javascript
// scripts/build-logs.js
const fs = require('fs');
const logs = generateLogs(); // Your log generation logic
fs.writeFileSync('public/logs.json', JSON.stringify(logs));
```

### Approach C: Edge Functions
Use Vercel Edge Functions for better compatibility:
```javascript
// /api/logs/activity.js
export const config = { runtime: 'edge' };

export default async function handler(request) {
  return new Response(JSON.stringify({ logs: [...] }), {
    headers: { 'Content-Type': 'application/json' }
  });
}
```

---

## Deployment Steps

Since I cannot authenticate with Vercel CLI in this environment, follow these steps:

### Option 1: Deploy via Git
1. Commit the changes:
   ```bash
   cd /root/.openclaw/workspace/mission-control/dashboard
   git add .
   git commit -m "Fix /api/logs/activity endpoint - simplified vercel.json and API handlers"
   git push origin main
   ```
2. Vercel should auto-deploy from the git integration

### Option 2: Deploy via Vercel Dashboard
1. Go to https://vercel.com/dashboard
2. Find the "dashboard" project
3. Click "Redeploy" or upload the files manually

### Option 3: Manual Vercel CLI (with auth)
```bash
cd /root/.openclaw/workspace/mission-control/dashboard
vercel login  # Complete browser auth
vercel --prod
```

---

## Testing After Deployment

Once deployed, test the endpoint:

```bash
# Test the main endpoint
curl https://dashboard-ten-sand-20.vercel.app/api/logs/activity

# Test with query params
curl "https://dashboard-ten-sand-20.vercel.app/api/logs/activity?limit=5"

# Test the flat file alternative
curl https://dashboard-ten-sand-20.vercel.app/api/logs-activity

# Test CORS
curl -H "Origin: https://example.com" \
     -H "Access-Control-Request-Method: GET" \
     -X OPTIONS \
     https://dashboard-ten-sand-20.vercel.app/api/logs/activity
```

---

## Files Modified

1. `/mission-control/dashboard/vercel.json` - Updated rewrite rules
2. `/mission-control/dashboard/api/logs/activity.js` - Simplified handler
3. `/mission-control/dashboard/api/logs-activity.js` - Flat file alternative

---

## Next Steps if Still Failing

1. **Check Vercel Function Logs**: Go to Vercel Dashboard > Project > Functions > Logs
2. **Try Edge Runtime**: Convert to `export const config = { runtime: 'edge' }`
3. **Use Static Fallback**: Serve pre-generated JSON from `/public/logs.json`
4. **Contact Vercel Support**: If all else fails, open a support ticket

---

*Report generated by API Troubleshooting Specialist*  
*Time: February 19, 2026 - 1:30 AM CST*
